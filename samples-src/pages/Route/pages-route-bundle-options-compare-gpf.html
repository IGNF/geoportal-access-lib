{{#extend "layout-sample-bundle"}}

{{#content "head"}}
<title>Service Itinéraire : comparaison GPF / ancien service</title>
{{/content}}

{{#content "style"}}
<style></style>
{{/content}}

{{#content "body"}}
<div id="params">
    <p>
        lon départ:
        <input type="text" id="lon1" size="10" value="2.9176" /> lat départ :
        <input type="text" id="lat1" size="10" value="49.0079"/>
    </p>
    <p>
        lon inter :
        <input type="text" id="lon2" size="10" value="2.8854"/> lat inter :
        <input type="text" id="lat2" size="10" value="48.9652"/>
    </p>
    <p>
        lon arrivée:
        <input type="text" id="lon3" size="10" value="2.7332"/> lat arrivée :
        <input type="text" id="lat3" size="10" value="48.7397"/>
    </p>
    <p> Eviter :
        <input type="checkbox" value="true" id="toll"> péages
        <input type="checkbox" value="true" id="bridge"> ponts
        <input type="checkbox" value="true" id="tunnel"> tunnels
    </p>
    <p>Graphe :
        <select id="graph">
            <option value="Pieton">Piéton</option>
            <option value="Voiture">Voiture</option>
        </select>
        Methode de calcul :
        <select id="method">
            <option value="fastest">le plus rapide</option>
            <option value="shortest">le plus court</option>
        </select>
    </p>
</div>
<div id="go">
    <input type="button" value="getRoute" onclick="go()" />
</div>
<h1>GEOPLATEFORME : Utilisation du Service de Calcul d'itinéraire</h1>
<div id="result1" class="results"></div>

<h1>WXS : Utilisation du Service de Calcul d'itinéraire</h1>
<div id="result2" class="results"></div>
{{/content}}

{{#content "js"}}
function go() {
// récupération des options du formulaire
var lon1 = document.getElementById("lon1").value;
var lat1 = document.getElementById("lat1").value;
var lon2 = document.getElementById("lon2").value;
var lat2 = document.getElementById("lat2").value;
var lon3 = document.getElementById("lon3").value;
var lat3 = document.getElementById("lat3").value;
var avoidFeatures = [];
var noToll = document.getElementById("toll").checked;
if (noToll) avoidFeatures.push("toll");
var noBridge = document.getElementById("bridge").checked;
if (noBridge) avoidFeatures.push("bridge");
var noTunnel = document.getElementById("tunnel").checked;
if (noTunnel) avoidFeatures.push("tunnel");
var graphIdx = document.getElementById("graph").selectedIndex;
var graph = document.getElementById("graph").options[graphIdx].value;
var methodIdx = document.getElementById("method").selectedIndex;
var method = document.getElementById("method").options[methodIdx].value;
var result1Div = document.getElementById("result1");
var result2Div = document.getElementById("result2");

// Appel service WXS

var routeOptionsWXS = {
    startPoint: {
      x: lon1,
      y: lat1
    },
    endPoint: {
      x: lon3,
      y: lat3
    },
    oldRouteService : true,
    resource : "bdtopo-osrm",
    graph: graph,
    avoidFeature: avoidFeatures,
    routePreference: method,
    onSuccess: function(result) {
      result2Div.innerHTML = "<p>" + JSON.stringify(result) + "</p>" ;
    },
    onFailure: function(error) {
      result2Div.innerHTML = "<p>" + error + "</p>" ;
    }
  };

  if (lon2 && lat2) {
    routeOptionsWXS.viaPoints = [{
        x: lon2,
        y: lat2
      }]
  }
Gp.Services.route(routeOptionsWXS);

  // Appel service GPF

  var routeOptionsGPF = {
    startPoint: {
      x: lon1,
      y: lat1
    },
    endPoint: {
      x: lon3,
      y: lat3
    },
    graph: graph,
    avoidFeature: avoidFeatures,
    routePreference: method,
    onSuccess: function(result) {
      result1Div.innerHTML = "<p>" + JSON.stringify(result) + "</p>" ;
    },
    onFailure: function(error) {
      result1Div.innerHTML = "<p>" + error + "</p>" ;
    }
  };

  if (lon2 && lat2) {
    routeOptionsGPF.viaPoints = [{
        x: lon2,
        y: lat2
      }]
  }

Gp.Services.route(routeOptionsGPF);
}
{{/content}}
{{/extend}}
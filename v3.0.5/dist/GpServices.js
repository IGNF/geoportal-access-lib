/*!
 * @brief Geoportal resources access library
 *
 * This software is released under the licence CeCILL-B (Free BSD compatible)
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-fr.txt
 * @see http://www.cecill.info/
 *
 * copyright CeCILL-B
 * copyright IGN
 * @author IGN
 * @version 3.0.5
 * @date 03/12/2021
 *
 */
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.4
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("xmldom"),require("node-fetch")):"function"==typeof define&&define.amd?define("Gp",["require","require"],t):"object"==typeof exports?exports.Gp=t(require("xmldom"),require("node-fetch")):e.Gp=t(e[void 0],e[void 0])}(this,(function(e,t){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=4)}([function(e){e.exports=JSON.parse('{"name":"geoportal-access-lib","version":"3.0.5","date":"03/12/2021","description":"French Geoportal resources access library","module":"src/Gp.js","main":"dist/GpServices-src.js","homepage":"https://github.com/IGNF/geoportal-access-lib#readme","scripts":{"clean":"echo \\"Warning: no yet implemented!\\" && exit 0","setup":"npm install","cover":"nyc --reporter=lcov --reporter=text npm run test","eslint":"eslint src/","build":"webpack --mode=none","build:prod":"webpack --mode=production","build:dev":"webpack --mode=development","test":"mocha-webpack --reporter mochawesome --reporter-options reportDir=test-report,reportFilename=index --webpack-config ./test/webpack/webpack.test.js --glob \\"test_*.js\\" test/spec/","test:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.js","test:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.docker.js","test:end-to-end:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.js","test:end-to-end:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.docker.js","sample":"npm run sample:serve","sample:serve":"webpack-dev-server --mode=none --open-page samples/index-src.html --https --content-base . --output-public-path \'/dist/\' --port 9001 --open","sample:serve:prod":"webpack-dev-server --mode=production --open-page samples/index-prod.html --content-base . --output-public-path \'/dist/\' --port 9001 --open","sample:serve:dev":"webpack-dev-server --mode=development --open-page samples/index-map.html --content-base . --output-public-path \'/dist/\' --port 9001 --open","doc":"npm run doc:serve","doc:serve":"webpack-dev-server --content-base jsdoc --port 9001 --open"},"nyc":{"include":["src/**/*.js"],"instrument":false,"sourceMap":false},"repository":{"type":"git","url":"https://github.com/IGNF/geoportal-access-lib.git"},"keywords":["geoportail","webservice","javascript","es6"],"author":"IGNF","license":"CECILL-B","dependencies":{"es6-promise":"^4.2.4","node-fetch":"^2.6.1","xmldom":"^0.1.27"},"devDependencies":{"@babel/core":"^7.12.10","@babel/plugin-transform-template-literals":"^7.12.1","@babel/preset-env":"^7.12.11","babel-loader":"^8.2.2","chai":"^4.1.2","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^5.1.2","eslint":"^7.18.0","eslint-config-standard":"^16.0.2","eslint-loader":"^4.0.2","eslint-plugin-import":"^2.22.1","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^5.0.0","glob":"^7.1.2","handlebars-layouts":"^3.1.4","handlebars-webpack-plugin":"^1.4.1","html-webpack-plugin":"^4.5.1","istanbul-instrumenter-loader":"^3.0.1","jsdoc-webpack-plugin":"^0.3.0","loglevel":"^1.6.1","mocha":"^7.2.0","mocha-loader":"^5.1.5","mocha-webpack":"^2.0.0-beta.0","mochawesome":"^6.2.1","nyc":"^15.1.0","path":"^0.12.7","replace-bundle-webpack-plugin":"^1.0.0","sinon":"^9.2.4","sinon-es6":"0.0.3","speed-measure-webpack-plugin":"^1.4.2","string-template":"^1.0.0","terser-webpack-plugin":"^2.3.8","webpack":"^4.46.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-node-externals":"^2.5.2","webpack-shell-plugin":"^0.5.0"},"bundledDependencies":[],"peerDependencies":{},"optionalDependencies":{}}')},function(e,t,o){var r,n;!function(s,i){"use strict";void 0===(n="function"==typeof(r=function(){var e=function(){},t="undefined"!=typeof window&&void 0!==window.navigator&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function r(e,t){var o=e[t];if("function"==typeof o.bind)return o.bind(e);try{return Function.prototype.bind.call(o,e)}catch(t){return function(){return Function.prototype.apply.apply(o,[e,arguments])}}}function n(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(o){return"debug"===o&&(o="log"),"undefined"!=typeof console&&("trace"===o&&t?n:void 0!==console[o]?r(console,o):void 0!==console.log?r(console,"log"):e)}function i(t,r){for(var n=0;n<o.length;n++){var s=o[n];this[s]=n<t?e:this.methodFactory(s,t,r)}this.log=this.debug}function a(e,t,o){return function(){"undefined"!=typeof console&&(i.call(this,t,o),this[e].apply(this,arguments))}}function l(e,t,o){return s(e)||a.apply(this,arguments)}function c(e,t,r){var n,s=this;t=null==t?"WARN":t;var a="loglevel";function c(){var e;if("undefined"!=typeof window&&a){try{e=window.localStorage[a]}catch(e){}if(void 0===e)try{var t=window.document.cookie,o=t.indexOf(encodeURIComponent(a)+"=");-1!==o&&(e=/^([^;]+)/.exec(t.slice(o))[1])}catch(e){}return void 0===s.levels[e]&&(e=void 0),e}}"string"==typeof e?a+=":"+e:"symbol"==typeof e&&(a=void 0),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=r||l,s.getLevel=function(){return n},s.setLevel=function(t,r){if("string"==typeof t&&void 0!==s.levels[t.toUpperCase()]&&(t=s.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(n=t,!1!==r&&function(e){var t=(o[e]||"silent").toUpperCase();if("undefined"!=typeof window&&a){try{return void(window.localStorage[a]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(a)+"="+t+";"}catch(e){}}}(t),i.call(s,t,e),"undefined"==typeof console&&t<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){t=e,c()||s.setLevel(e,!1)},s.resetLevel=function(){s.setLevel(t,!1),function(){if("undefined"!=typeof window&&a){try{return void window.localStorage.removeItem(a)}catch(e){}try{window.document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var u=c();null==u&&(u=t),s.setLevel(u,!1)}var u=new c,p={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=p[e];return t||(t=p[e]=new c(e,u.getLevel(),u.methodFactory)),t};var h="undefined"!=typeof window?window.log:void 0;return u.noConflict=function(){return"undefined"!=typeof window&&window.log===u&&(window.log=h),u},u.getLoggers=function(){return p},u.default=u,u})?r.call(t,o,t,e):r)||(e.exports=n)}()},function(t,o){t.exports=e},function(e,t,o){(function(t,o){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var r;r=function(){"use strict";function e(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,s=void 0,i=void 0,a=function(e,t){g[n]=e,g[n+1]=t,2===(n+=2)&&(i?i(d):_())},l="undefined"!=typeof window?window:void 0,c=l||{},u=c.MutationObserver||c.WebKitMutationObserver,p="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(d,1)}}var g=new Array(1e3);function d(){for(var e=0;e<n;e+=2)(0,g[e])(g[e+1]),g[e]=void 0,g[e+1]=void 0;n=0}var m,y,E,v,_=void 0;function w(e,t){var o=this,r=new this.constructor(b);void 0===r[R]&&L(r);var n=o._state;if(n){var s=arguments[n-1];a((function(){return I(n,r,s,o._result)}))}else C(o,r,e,t);return r}function S(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(b);return T(t,e),t}p?_=function(){return t.nextTick(d)}:u?(y=0,E=new u(d),v=document.createTextNode(""),E.observe(v,{characterData:!0}),_=function(){v.data=y=++y%2}):h?((m=new MessageChannel).port1.onmessage=d,_=function(){return m.port2.postMessage(0)}):_=void 0===l?function(){try{var e=Function("return this")().require("vertx");return void 0!==(s=e.runOnLoop||e.runOnContext)?function(){s(d)}:f()}catch(e){return f()}}():f();var R=Math.random().toString(36).substring(2);function b(){}function A(t,o,r){o.constructor===t.constructor&&r===w&&o.constructor.resolve===S?function(e,t){1===t._state?P(e,t._result):2===t._state?x(e,t._result):C(t,void 0,(function(t){return T(e,t)}),(function(t){return x(e,t)}))}(t,o):void 0===r?P(t,o):e(r)?function(e,t,o){a((function(e){var r=!1,n=function(e,t,o,r){try{e.call(t,o,r)}catch(e){return e}}(o,t,(function(o){r||(r=!0,t!==o?T(e,o):P(e,o))}),(function(t){r||(r=!0,x(e,t))}),e._label);!r&&n&&(r=!0,x(e,n))}),e)}(t,o,r):P(t,o)}function T(e,t){if(e===t)x(e,new TypeError("You cannot resolve a promise with itself"));else if(n=typeof(r=t),null===r||"object"!==n&&"function"!==n)P(e,t);else{var o=void 0;try{o=t.then}catch(t){return void x(e,t)}A(e,t,o)}var r,n}function O(e){e._onerror&&e._onerror(e._result),N(e)}function P(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&a(N,e))}function x(e,t){void 0===e._state&&(e._state=2,e._result=t,a(O,e))}function C(e,t,o,r){var n=e._subscribers,s=n.length;e._onerror=null,n[s]=t,n[s+1]=o,n[s+2]=r,0===s&&e._state&&a(N,e)}function N(e){var t=e._subscribers,o=e._state;if(0!==t.length){for(var r=void 0,n=void 0,s=e._result,i=0;i<t.length;i+=3)r=t[i],n=t[i+o],r?I(o,r,n,s):n(s);e._subscribers.length=0}}function I(t,o,r,n){var s=e(r),i=void 0,a=void 0,l=!0;if(s){try{i=r(n)}catch(e){l=!1,a=e}if(o===i)return void x(o,new TypeError("A promises callback cannot return that same promise."))}else i=n;void 0!==o._state||(s&&l?T(o,i):!1===l?x(o,a):1===t?P(o,i):2===t&&x(o,i))}var M=0;function L(e){e[R]=M++,e._state=void 0,e._result=void 0,e._subscribers=[]}var D=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(b),this.promise[R]||L(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?P(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&P(this.promise,this._result))):x(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;void 0===this._state&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var o=this._instanceConstructor,r=o.resolve;if(r===S){var n=void 0,s=void 0,i=!1;try{n=e.then}catch(e){i=!0,s=e}if(n===w&&void 0!==e._state)this._settledAt(e._state,t,e._result);else if("function"!=typeof n)this._remaining--,this._result[t]=e;else if(o===F){var a=new o(b);i?x(a,s):A(a,e,n),this._willSettleAt(a,t)}else this._willSettleAt(new o((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,o){var r=this.promise;void 0===r._state&&(this._remaining--,2===e?x(r,o):this._result[t]=o),0===this._remaining&&P(r,this._result)},e.prototype._willSettleAt=function(e,t){var o=this;C(e,void 0,(function(e){return o._settledAt(1,t,e)}),(function(e){return o._settledAt(2,t,e)}))},e}(),F=function(){function t(e){this[R]=M++,this._result=this._state=void 0,this._subscribers=[],b!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){T(e,t)}),(function(t){x(e,t)}))}catch(t){x(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var o=this.constructor;return e(t)?this.then((function(e){return o.resolve(t()).then((function(){return e}))}),(function(e){return o.resolve(t()).then((function(){throw e}))})):this.then(t,t)},t}();return F.prototype.then=w,F.all=function(e){return new D(this,e).promise},F.race=function(e){var t=this;return r(e)?new t((function(o,r){for(var n=e.length,s=0;s<n;s++)t.resolve(e[s]).then(o,r)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},F.resolve=S,F.reject=function(e){var t=new this(b);return x(t,e),t},F._setScheduler=function(e){i=e},F._setAsap=function(e){a=e},F._asap=a,F.polyfill=function(){var e=void 0;if(void 0!==o)e=o;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=F},F.Promise=F,F},e.exports=r()}).call(this,o(5),o(6))},function(e,t,o){e.exports=o(8)},function(e,t){var o,r,n=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(e){if(o===setTimeout)return setTimeout(e,0);if((o===s||!o)&&setTimeout)return o=setTimeout,setTimeout(e,0);try{return o(e,0)}catch(t){try{return o.call(null,e,0)}catch(t){return o.call(this,e,0)}}}!function(){try{o="function"==typeof setTimeout?setTimeout:s}catch(e){o=s}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var l,c=[],u=!1,p=-1;function h(){u&&l&&(u=!1,l.length?c=l.concat(c):p=-1,c.length&&f())}function f(){if(!u){var e=a(h);u=!0;for(var t=c.length;t;){for(l=c,c=[];++p<t;)l&&l[p].run();p=-1,t=c.length}l=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function d(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];c.push(new g(e,t)),1!==c.length||u||a(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=d,n.addListener=d,n.once=d,n.off=d,n.removeListener=d,n.removeAllListeners=d,n.emit=d,n.prependListener=d,n.prependOnceListener=d,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t){var o;o=function(){return this}();try{o=o||new Function("return this")()}catch(e){"object"==typeof window&&(o=window)}e.exports=o},function(e,o){e.exports=t},function(e,t,o){"use strict";o.r(t),o.d(t,"servicesVersion",(function(){return ho})),o.d(t,"servicesDate",(function(){return fo}));var r=o(1),n={getLogger:function(e){"true".match(/true/)?r.disableAll():r.enableAll();var t=e||"default";return r.getLogger(t)}},s={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(e,t){if(0===Object.keys(arguments).length)return"Message indefined !";var o=Array.prototype.slice.call(arguments),r=o.shift(),n=o,s=this[r];try{s=Array.isArray(n)&&n.length>0?s.replace("%var%",n.join(" - ")):s.replace("%var%","%var% (not specified)")}catch(e){}return s}};function i(e){if(!(this instanceof i))throw new TypeError("ErrorService constructor cannot be called as a function.");var t=e;"string"==typeof e||e instanceof String?(this.message=e,this.status=-1,this.type=i.TYPE_UNKERR):(this.message=t.message||"undefined!?",this.type=t.type,this.status=t.status||-1),this.name="ErrorService",this.stack=(new Error).stack}i.TYPE_SRVERR="SERVICE_ERROR",i.TYPE_USEERR="USAGE_ERROR",i.TYPE_UNKERR="UNKNOWN_ERROR",i.prototype=Object.create(Error.prototype,{constructor:{value:i,writable:!0,configurable:!0}});var a=i,l={normalyzeParameters:function(e){var t=null;if(e){var o=[];for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];n||(n=""),o.push(r+"="+n)}t=o.join("&")}return t},normalyzeUrl:function(e,t,o){var r=e;if(e){var n=e.indexOf("?");-1===n&&(r+="?"),-1!==n&&n!==e.length-1&&(r+="&")}return t&&(r+="string"==typeof t?t:this.normalyzeParameters(t)),o&&(r=encodeURIComponent(r)),r},indent:function(e,t){return new Array((e||0)+1).join("\t")+t}},c=o(3),u=o.n(c);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var h,f={call:function(e){var t=n.getLogger("XHR");if(t.trace("[XHR::call()]"),u.a.polyfill(),!e.url)throw new Error("missing parameter : url is not defined !");if(!e.method)throw new Error("missing parameter : method is not defined !");e.format||(e.format="text");var o={};switch(o.url=e.url,o.data=e.data?e.data:null,o.method=e.method,o.timeOut=e.timeOut||0,o.scope=e.scope||this,o.proxy=e.proxy||null,o.content=e.content||null,o.headers=e.headers||{referer:"http://localhost"},e.method){case"DELETE":case"GET":break;case"PUT":case"POST":o.content=e.content?e.content:"application/x-www-form-urlencoded",o.headers=e.headers?e.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(e.format){case"text":this.__call(o).then((function(o){t.trace(o),e.onResponse.call(this,o)})).catch((function(t){e.onFailure.call(this,t)}));break;case"json":this.__callJSON(o).then((function(o){t.trace(o),e.onResponse.call(this,o)})).catch((function(t){e.onFailure.call(this,t)}));break;case"xml":this.__callXML(o).then((function(o){t.trace(o),e.onResponse.call(this,o)})).catch((function(t){e.onFailure.call(this,t)}));break;default:throw new Error("This output Format is not yet supported !")}},__call:function(e){var t=n.getLogger("XHR");return t.trace("[XHR::__call()]"),new Promise((function(r,n){var s="POST"===e.method||"PUT"===e.method?1:0;e.data&&("object"===p(e.data)&&Object.keys(e.data).length||"string"==typeof e.data&&e.data.length)&&!s&&(e.url=l.normalyzeUrl(e.url,e.data)),t.trace("URL = ",e.url);var i=null;if("undefined"==typeof window){var a=o(7),c={headers:{Referer:"https://localhost"}};return e.data&&"string"==typeof e.data&&s&&(c={method:e.method,body:e.data,headers:{"Content-Type":e.content,Referer:"https://localhost"}}),a(e.url,c).then((function(e){if(e.ok)r(e.text());else{var t="Errors Occured on Http Request (status : '"+e.statusText+"' | url : '"+e.url+"')",o=e.status;n({message:t,status:o})}})).catch((function(e){n({message:e,status:-1})}))}if(window.XMLHttpRequest){t.trace("XMLHttpRequest"),(i=new XMLHttpRequest).open(e.method,e.url,!0),i.overrideMimeType=e.content;var u=null;e.timeOut>0&&(t.trace("XHR - TimeOut actif !"),u=window.setTimeout((function(){n({message:"TimeOut Occured on Http Request with XMLHttpRequest !",status:-1})}),e.timeOut)),s&&(t.trace("data = ",e.data),i.setRequestHeader("Content-type",e.content)),i.onerror=function(e){console.log(e),n(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},i.ontimeout=function(e){console.log(e),n(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},i.onreadystatechange=function(e){if(4===i.readyState)if(200===i.status)window.clearTimeout(u),r(i.response);else{var t="Errors Occured on Http Request (status : '"+e.target.statusText+"' | url : '"+e.target.responseURL+"')",o=e.target.status;n({message:t,status:o})}};var h=e.data&&s?e.data:null;i.send(h)}else{if(!window.XDomainRequest)throw new Error("CORS not supported");t.trace("XDomainRequest"),(i=new XDomainRequest).open(e.method,e.url),i.overrideMimeType=e.content,e.timeOut>0&&(i.timeout=e.timeout,t.trace("XHR - TimeOut actif !")),s&&i.setRequestHeader("Content-type",e.content),i.onerror=function(){n(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},i.ontimeout=function(){n(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},i.onload=function(e){if(200===i.status)r(i.responseText);else{var t="Errors Occured on Http Request (status : '"+e.target.statusText+"' | url : '"+e.target.responseURL+"')",o=e.target.status;n({message:t,status:o})}};var f=e.data&&s?e.data:null;i.send(f)}}))},__callJSON:function(e){return this.__call(e).then(JSON.parse).catch((function(t){console.log("_callJSON failed on : ",e.url,t)}))},__callXML:function(e){return this.__call(e).then((function(e){var t;"undefined"==typeof window?t=(new(0,o(2).DOMParser)).parseFromString(e,"text/xml"):window.DOMParser?t=(new window.DOMParser).parseFromString(e,"text/xml"):((t=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e));return t})).catch((function(t){console.log("__callXML failed on : ",e.url,t)}))}},g={uuid:(h=Math.floor(Date.now()),function(){return h++}),call:function(e){var t=n.getLogger("JSONP");if(t.trace("[JSONP::call ()]"),!e)throw t.error("missing parameter : options !"),new Error("missing parameter : options !");if(!e.url)throw t.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(e.timeOut||(t.info("setting 'options.timeOut' default value"),e.timeOut=0),!e.onResponse)throw t.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var o="string"==typeof e.callbackSuffix?e.callbackSuffix:this.uuid(),r=!1,s=!1,i=e.url.indexOf("callback=");if(-1!==i){r=!0;var a=e.url.indexOf("&",i);-1===a&&(a=e.url.length);var l=e.url.substring(i+9,a);l&&(s=!0,e.callbackName=l,t.info("setting 'options.callbackName' value ("+e.callbackName+") from 'options.url' parameter"))}if(!r){var c=e.url.indexOf("?");-1===c?e.url=e.url+"?callback=":c===e.url.length?e.url=e.url+"callback=":e.url=e.url+"&callback=",t.info("setting callback default key in 'options.url' : "+e.url)}var u=!!e.callbackName||s;if(s||(e.callbackName||(t.info("setting 'options.callbackName' default value"),e.callbackName="callback",(o||""===o)&&(e.callbackName+=o)),e.url=e.url.replace("callback=","callback="+e.callbackName),t.info("setting callback function name in 'options.url' : "+e.url)),e.onTimeOut||(t.info("setting 'options.onTimeOut' default value"),e.onTimeOut=function(){console.log("TimeOut while invoking url : "+e.url)}),!u){var p=this,h=null;e.timeOut>0&&(h=window.setTimeout((function(){window[e.callbackName]=function(){},e.onTimeOut(),p._deleteScript(o)}),e.timeOut)),window[e.callbackName]=function(t){window.clearTimeout(h),e.onResponse(t),p._deleteScript(o)}}this._createScript(o,e.url)},_createScript:function(e,t){var o,r=document.getElementById("results"+e);(o=document.createElement("script")).setAttribute("type","text/javascript"),o.setAttribute("src",t),o.setAttribute("charset","UTF-8"),o.setAttribute("id","results"+e),o.setAttribute("async","true");var n=document.documentElement||document.getElementsByTagName("head")[0];null===r?n.appendChild(o):n.replaceChild(o,r)},_deleteScript:function(e){var t=document.getElementById("results"+e);if(t){var o=t.parentNode||document.documentElement;if(!o)return;o.removeChild(t)}}},d={send:function(e){var t=e||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if("undefined"!=typeof window||"JSONP"!==e.protocol){if("XHR"===e.protocol||"json"===e.format?t.wrap=!1:"JSONP"===e.protocol&&"xml"===e.format&&(t.wrap=!0),t.callback=null,t.output=t.wrap?"json":null,t.wrap){var o={};o.output=t.output,o.callback=t.callback,delete o.callback,t.url=l.normalyzeUrl(e.url,o)}switch(t.protocol){case"XHR":"GET"===e.method&&e.nocache&&(t.url=l.normalyzeUrl(t.url,{t:(new Date).getTime()})),f.call(t);break;case"JSONP":t.data&&(t.url=l.normalyzeUrl(t.url,t.data)),g.call(t);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}else console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS")}},m={ssl:!0,url:function(e,t){return(!1===m.ssl?"http://":"https://")+"wxs.ign.fr".concat("/",e,t)},Alti:{_key:{"elevation-json":"/alti/rest/elevation.json","elevation-xml":"/alti/rest/elevation.xml","profil-json":"/alti/rest/elevationLine.json","profil-xml":"/alti/rest/elevationLine.xml",wps:"/alti/wps"},url:function(e){return{"elevation-json":m.url(e,this._key["elevation-json"]),"elevation-xml":m.url(e,this._key["elevation-xml"]),"profil-json":m.url(e,this._key["profil-json"]),"profil-xml":m.url(e,this._key["profil-xml"]),wps:m.url(e,this._key.wps)}}},ProcessIsoCurve:{_key:{"iso-json":"/isochrone/isochrone.json","iso-xml":"/isochrone/isochrone.xml"},url:function(e){return{"iso-json":m.url(e,this._key["iso-json"]),"iso-xml":m.url(e,this._key["iso-xml"])}}},AutoComplete:{_key:"/ols/apis/completion",url:function(e){return m.url(e,this._key)}},ReverseGeocode:{_key:"/geoportail/ols",url:function(e){return m.url(e,this._key)}},AutoConf:{_key:{apiKey:"/autoconf",apiKeys:"/autoconf?keys=%KEYS%",aggregate:"/autoconf/id/"},url:function(e){var t="";if(Array.isArray(e)&&e.length>0){t=e[0];for(var o=1;o<e.length;o++)t+=","+e[o]}return{apiKey:m.url(e,this._key.apiKey),apiKeys:m.url(e[0],this._key.apiKeys).replace("%KEYS%",t),aggregate:m.url(e,this._key.aggregate)}}},Geocode:{_key:"/geoportail/ols",url:function(e){return m.url(e,this._key)}},Route:{_key:"/geoportail/itineraire/rest/1.0.0/route",url:function(e){return m.url(e,this._key)}}},y=m,E=o(0);function v(e){if(!(this instanceof v))throw new TypeError(s.getMessage("CLASS_CONSTRUCTOR"));for(var t in this.logger=n.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(e){console.log("onSuccess - la reponse est la suivante : ",e)},onFailure:function(e){200!==e.status&&e.status?console.log("onFailure - Erreur (",e.status,") : ",e.message):console.log("onFailure : ",e.message)}},e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);if(!this.options.apiKey&&!this.options.serverUrl)throw new Error(s.getMessage("PARAM_MISSING","apiKey","serverUrl"));if(this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(e){console.log("onSuccess - la réponse brute du service est la suivante : ",e)}),!!(null===this.options.onSuccess||"function"!=typeof this.options.onSuccess))throw new Error(s.getMessage("PARAM_MISSING","onSuccess()"));if(!this.options.serverUrl){y.ssl=this.options.ssl;var o=y[this.CLASSNAME].url(this.options.apiKey);"string"==typeof o?this.options.serverUrl=o:this.logger.trace("URL par defaut à determiner au niveau du composant...")}switch(this.options.httpMethod="string"==typeof e.httpMethod?e.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(s.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(s.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol="string"==typeof e.protocol?e.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(s.getMessage("PARAM_UNKNOWN","protocol"))}if("undefined"==typeof window&&"JSONP"===this.options.protocol)throw new Error(s.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));"JSONP"===this.options.protocol&&(this.options.httpMethod="GET"),this.options.nocache=e.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}v.prototype={constructor:v,call:function(){this.logger.trace("CommonService::call ()");var e=this;function t(t){this.logger.trace("CommonService::onBuildRequest : ",t),this.callService.call(e,n,o)}function o(t){this.logger.trace("CommonService::onCallService : ",t),this.analyzeResponse.call(e,n,r)}function r(e){if(this.logger.trace("CommonService::onAnalyzeResponse : ",e),!e)return n.call(this,new a("Analyse de la reponse en échec !?"));this.options.onSuccess.call(this,e)}function n(e){this.logger.trace("CommonService::onError()");var t=e;t instanceof a||(t=new a(e.message)),this.options.onFailure.call(this,t)}(function(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(e,n,t)}).call(e)},buildRequest:function(e,t){this.logger.error("overwritten method !"),e&&e.call(this,"This method must be overwritten !"),t.call(this,"This method must be overwritten !")},callService:function(e,t){var o=null,r=this.request,n=!(!this.options.proxyURL||"XHR"!==this.options.protocol);this.options.serverUrl=l.normalyzeUrl(this.options.serverUrl,{"gp-access-lib":E.version},!1),n&&("GET"===this.options.httpMethod&&(o=this.options.proxyURL+l.normalyzeUrl(this.options.serverUrl,this.request,!0),r=null),"POST"===this.options.httpMethod&&(o=this.options.proxyURL+l.normalyzeUrl(this.options.serverUrl,null,!0),r=this.request));var s=this,i={url:o||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:"XHR"!==this.options.protocol,callbackSuffix:this.options.callbackSuffix,data:r,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(o){s.logger.trace("callService::onResponse()");var r=null;if("XHR"===s.options.protocol&&(s.logger.trace("Response XHR",o),r=o),"JSONP"===s.options.protocol){if(s.logger.trace("Response JSON",o),!o)return void e.call(s,new a("Le contenu de la reponse est vide !?"));if(o.http){if(200!==o.http.status)return void e.call(s,new a({status:o.http.status,message:o.http.error,type:a.TYPE_SRVERR}));r=o.xml,s.options.rawResponse&&(r=o)}else r=o}if("function"==typeof s.options.onBeforeParse){var n=s.options.onBeforeParse(r);"string"==typeof n&&(r=n)}s.response=r,t.call(s,r)},onFailure:function(t){s.logger.trace("callService::onFailure()"),t.type=a.TYPE_SRVERR,e.call(s,new a(t))},onTimeOut:function(){s.logger.trace("callService::onTimeOut()"),e.call(s,new a("TimeOut!"))}};d.send(i)},analyzeResponse:function(e,t){this.logger.error("overwritten method !"),e&&e.call(this,"This method must be overwritten !"),t.call(this,"This method must be overwritten !")}};var _=v;function w(e){if(!(this instanceof w))throw new TypeError("AltiRequest constructor cannot be called as a function.");this.logger=n.getLogger(),this.logger.trace("[Constructeur AltiRequest ()]"),this.options=e||{},this.positions=this.options.positions||[],this.delimiter=this.options.delimiter||"|",this.indent=this.options.indent||!1,this.crs=this.options.crs||"CRS:84",this.format=this.options.format||"json"}w.CLASSNAME="AltiRequest",w.prototype={constructor:w,setPositions:function(e){for(var t=[],o=0;o<e.length;o++){var r=e[o];r.lon&&r.lat&&t.push(r)}this.positions=t},getPositions:function(e){if(!e)return this.positions;var t=this.positions.length-1;return e>t||e<t?(this.logger.warn("index out of range !"),this.positions):this.positions[e]},addPositions:function(e){for(var t=0;t<e.length;t++){var o=e[t];o.lon&&o.lat&&this.positions.push(e[t])}},getLon:function(){for(var e=[],t=0;t<this.positions.length;t++)e.push(this.positions[t].lon);return this.logger.trace(e),e.join(this.delimiter)},getLat:function(){for(var e=[],t=0;t<this.positions.length;t++)e.push(this.positions[t].lat);return this.logger.trace(e),e.join(this.delimiter)}},w.prototype.getData=function(){var e=[];return e.push({k:"lon",v:this.getLon()}),e.push({k:"lat",v:this.getLat()}),e.push({k:"delimiter",v:this.delimiter}),e.push({k:"indent",v:this.indent}),e.push({k:"crs",v:this.crs}),e.push({k:"format",v:this.format}),e};var S=w;function R(e){if(!(this instanceof R))throw new TypeError("AltiElevationRequest constructor cannot be called as a function.");this.CLASSNAME="AltiElevationRequest",S.apply(this,arguments),this.logger=n.getLogger(),this.logger.trace("[Constructeur AltiElevationRequest ()]"),this.zonly=this.options.zonly||!1}R.prototype=Object.create(S.prototype,{zonly:{get:function(){return this._zonly},set:function(e){this._zonly=e}}}),R.prototype.constructor=R,R.prototype.getData=function(){var e=[];return e.push({k:"lon",v:this.getLon()}),e.push({k:"lat",v:this.getLat()}),e.push({k:"indent",v:this.indent}),e.push({k:"crs",v:this.crs}),e.push({k:"zonly",v:this.zonly}),e.push({k:"format",v:this.format}),e};var b=R;function A(e){if(!(this instanceof A))throw new TypeError("AltiProfilRequest constructor cannot be called as a function.");this.CLASSNAME="AltiProfilRequest",S.apply(this,arguments),this.logger=n.getLogger(),this.logger.trace("[Constructeur AltiProfilRequest ()]"),this.sampling=this.options.sampling||3}A.prototype=Object.create(S.prototype,{sampling:{get:function(){return this._sampling},set:function(e){this._sampling=e}}}),A.prototype.constructor=A,A.prototype.getData=function(){var e=[];return e.push({k:"lon",v:this.getLon()}),e.push({k:"lat",v:this.getLat()}),e.push({k:"indent",v:this.indent}),e.push({k:"crs",v:this.crs}),e.push({k:"sampling",v:this.sampling}),e.push({k:"format",v:this.format}),e};var T=A;function O(e){if(this.logger=n.getLogger("AltiRequestREST"),this.logger.trace("[Constructeur AltiRequestREST ()]"),!(this instanceof O))throw new TypeError("AltiRequestREST constructor cannot be called as a function.");if(this.options=e||{},!this.options)throw new Error(s.getMessage("PARAM_EMPTY","options"));if(!this.options.type)throw new Error(s.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));switch(this.DataObject=null,this.options.type){case"Elevation":this.DataObject=new b(this.options.param);break;case"Profil":this.DataObject=new T(this.options.param);break;default:throw new Error(s.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}this.method=this.options.method||"GET"}O.prototype={requestString:null,constructor:O,template:{get:{value:"lon=__LON__&lat=__LAT__&indent=__INDENT__&crs='__CRS__'",input:{point:"&zonly=__ZONLY__",profil:"&sampling=__SAMPLING__"}},post:{value:"lon=__LON__\nlat=__LAT__\nindent=__INDENT__\ncrs='__CRS__'\n",input:{point:"zonly=__ZONLY__",profil:"sampling=__SAMPLING__"}}},processRequestString:function(){this.logger.trace("AltiRequestREST::processRequestString ()");var e="";return"POST"===this.method?e=this.template.post.value:"GET"===this.method&&(e=this.template.get.value),e=(e=(e=(e=e.replace(/__LON__/g,this.DataObject.getLon())).replace(/__LAT__/g,this.DataObject.getLat())).replace(/__INDENT__/g,this.DataObject.indent)).replace(/__CRS__/g,this.DataObject.crs),e+=this.__addDataInputs(),this.logger.trace("traduction tmpl",e),this.requestString=e,this.requestString},__addDataInputs:function(){var e;if(this.logger.trace("AltiRequestREST::addDataInput ()"),"POST"===this.method)e=this.template.post;else{if("GET"!==this.method)throw new Error("No other HTTP method supported by the service !");e=this.template.get}if("AltiElevationRequest"===this.DataObject.CLASSNAME)return e.input.point.replace(/__ZONLY__/g,this.DataObject.zonly);if("AltiProfilRequest"===this.DataObject.CLASSNAME)return e.input.profil.replace(/__SAMPLING__/g,this.DataObject.sampling);throw new Error("No other object supported than elevation or profil !?")}};var P=O;function x(e){if(this.logger=n.getLogger(),this.logger.trace("[Constructeur WPS()]"),!(this instanceof x))throw new TypeError("WPS constructor cannot be called as a function.");if(this.options=e||{},this.DataObject=this.options.data,!this.DataObject)throw new TypeError("This data object is not defined !");this.paramservice=this.options.param.service||"WPS",this.paramversion=this.options.param.version||"1.0.0",this.paramidentifier=this.options.param.identifier||"gs:WPS",this.paramrawdataoutput=this.options.param.rawdataoutput||"result",this.paramrequest=this.options.param.request||"Execute",this.method=this.options.method||"GET"}x.prototype={requestString:null,constructor:x,template:{get:{value:"service=__SERVICE__&version=__VERSION__&rawdataoutput=__RAWDATAOUTPUT__&identifier=__IDENTIFIER__&request=__REQUEST__&datainputs=\x3c!-- __DATAINPUTS__ --\x3e",input:"__KEY__=__DATA__"},post:{value:'<?xml version="1.0" encoding="UTF-8"?><wps:__REQUEST__ version="__VERSION__" service="__SERVICE__" __NAMESPACE__ __SCHEMALOCATION__><ows:Identifier>__IDENTIFIER__</ows:Identifier><wps:DataInputs>\x3c!-- __DATAINPUTS__ --\x3e</wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:__REQUEST__>',input:"<wps:Input><ows:Identifier>__KEY__</ows:Identifier><wps:Data><wps:LiteralData>__DATA__</wps:LiteralData></wps:Data></wps:Input>"}},namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns="http://www.opengis.net/wps/1.0.0"','xmlns:wfs="http://www.opengis.net/wfs"','xmlns:wps="http://www.opengis.net/wps/1.0.0"','xmlns:ows="http://www.opengis.net/ows/1.1"','xmlns:gml="http://www.opengis.net/gml"','xmlns:ogc="http://www.opengis.net/ogc"','xmlns:wcs="http://www.opengis.net/wcs/1.1.1"','xmlns:xlink="http://www.w3.org/1999/xlink"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"'},processRequestString:function(){this.logger.trace("WPS::processRequestString ()");var e="";if("POST"===this.method)e=this.template.post.value;else{if("GET"!==this.method)return this.logger.error("No other method supported by the service !"),!1;e=this.template.get.value}return e=(e=(e=(e=(e=e.replace(/__SERVICE__/g,this.paramservice)).replace(/__VERSION__/g,this.paramversion)).replace(/__RAWDATAOUTPUT__/g,this.paramrawdataoutput)).replace(/__IDENTIFIER__/g,this.paramidentifier)).replace(/__REQUEST__/g,this.paramrequest),"POST"===this.method&&(e=(e=e.replace(/__NAMESPACE__/g,this.namespaceByDefault)).replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault)),(e=e.replace(/<!-- __DATAINPUTS__ -->/g,this.__addDataInputs()))?(this.requestString=e,this.logger.trace("traduction tmpl",e),!0):(this.logger.warn("traduction tmpl : empty request !?"),!1)},__addDataInputs:function(){this.logger.trace("WPS::__addDataInputs ()");for(var e,t="GET"===this.method?this.template.get.input:this.template.post.input,o="GET"===this.method?";":"",r="",n=this,s=this.DataObject.getData(),i=0;i<s.length;i++)e=i,o&&(o=e===s.length-1?"":";"),r=r.concat(n.__addDataInput(t,s[e].k,s[e].v),o);return r},__addDataInput:function(e,t,o){var r=e;return r=(r=r.replace(/__KEY__/g,t)).replace(/__DATA__/g,o)},setMethod:function(e){"GET"===e||"POST"===e?this.method=e:this.logger.warn("support only GET and POST method !")},getMethod:function(){return this.method}};var C=x,N={build:function(e){if(n.getLogger("AltiRequestWPS").trace(["AltiRequestWPS::build()"]),!e)throw new Error(s.getMessage("PARAM_EMPTY","options"));if(!e.type)throw new Error(s.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));var t=null;switch(e.type){case"Elevation":e.wps.identifier="gs:WPSElevation",t=new b(e.param);break;case"Profil":e.wps.identifier="gs:WPSLineElevation",t=new T(e.param);break;default:throw new Error(s.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}var o={data:t,method:e.method,param:e.wps},r=new C(o);if(!r.processRequestString())throw new Error("Enable to process request !");return r.requestString}},I={build:function(e){n.getLogger("AltiRequestFactory").trace(["AltiRequestFactory::build()"]);var t=null,o={type:e.sampling?"Profil":"Elevation",method:e.httpMethod,param:{positions:null,delimiter:null,indent:null,crs:null,format:null,sampling:null,zonly:null}};o.param.positions=e.positions,o.param.format=e.outputFormat,o.param.sampling=e.sampling,o.param.zonly=e.zonly;var r=!(null===e.onError||"function"!=typeof e.onError),s=!(null===e.onSuccess||"function"!=typeof e.onSuccess),i=null;switch(e.api){case"REST":var l=new P(o);if(!l.processRequestString()){if(i="Error in process request (rest) !",r)return void e.onError.call(e.scope,new a(i));throw new Error(i)}t=l.requestString;break;case"WPS":if(o.wps={service:null,version:null,identifier:null,rawdataoutput:null,request:null},!(t=N.build(o))){if(i="Error in process request (wps) !",r)return void e.onError.call(e.scope,new a(i));throw new Error(i)}break;default:if(i="Type of API is not supported by service (REST or WPS) !",r)return void e.onError.call(e.scope,new a(i));throw new Error(i)}return s&&e.onSuccess.call(e.scope,t),t}};function M(e){if(!(this instanceof M))throw new TypeError("XML constructor cannot be called as a function.");this.logger=n.getLogger(),this.logger.trace("[Constructeur XML ()]"),this.xmlString=null,this.xmlDoc=null,this.reader=null,e&&(e.xmlString&&"string"==typeof e.xmlString&&(this.xmlString=e.xmlString,this.xmlDoc=L(e.xmlString)),e.reader&&this.setReader(e.reader))}function L(e){if("undefined"==typeof window)return(new(0,o(2).DOMParser)).parseFromString(e,"text/xml");var t,r,n="Erreur lors du parsing de la réponse du service : XML non conforme";if(window.ActiveXObject){(r=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,r.loadXML(e);var s=r.parseError;if(s.errorCode)throw s.line&&s.linepos&&(n+="( ligne "+s.line+", colonne "+s.linepos),s.reason&&(n+=":  "+s.reason+")"),new Error(n);return r}if(window.DOMParser){t=new window.DOMParser;try{r=t.parseFromString(e,"text/xml")}catch(e){throw"SyntaxError"===e.message?new Error(n):new Error("Erreur lors du parsing de la réponse du service : "+e.message)}if(r.getElementsByTagName("parsererror").length>0)for(var i=r.getElementsByTagName("parsererror"),a=0;a<i.length;a++){var l=i[a].innerHTML;if(-1===l.indexOf("Huge input lookup"))throw n+="("+l+")",new Error(n)}else if(!r.documentElement)throw new Error(n);return r}throw new Error("Incompatible DOM Parser pour ce navigateur !")}M.prototype={constructor:M,getXMLString:function(){return this.xmlString},setXMLString:function(e){e&&"string"==typeof e&&(this.xmlString=e,this.xmlDoc=L(e))},getReader:function(){return this.reader},setReader:function(e){e&&e.read&&"function"==typeof e.read&&(this.reader=e)},getXMLDoc:function(){return this.xmlDoc},setXMLDoc:function(e){this.xmlDoc=e},parse:function(){if(!this.xmlDoc&&this.xmlString&&(this.xmlDoc=L(this.xmlString)),this.xmlDoc){var e,t=function(e){var t;9===e.nodeType?t=e.documentElement:1===e.nodeType&&(t=e);return t}(this.xmlDoc);return t?(this.reader&&this.reader.read?e=this.reader.read(t):(e={})[t.nodeName]=function e(t){var o={};if(t.attributes.length>0){var r=function(e){if(e.attributes.length>0){for(var t={},o=e.attributes,r=0;r<o.length;r++){var n=o[r];t[n.nodeName]=n.nodeValue}return t}}(t);o.attributes=r}if(t.hasChildNodes())for(var n,s={},i=t.childNodes,a=0;a<i.length;a++)if(3===(n=i[a]).nodeType)o.textContent=n.nodeValue;else if(1===n.nodeType)if(s=e(n),o[n.nodeName]){if(!Array.isArray(o[n.nodeName])){var l=o[n.nodeName];o[n.nodeName]=[],o[n.nodeName].push(l)}o[n.nodeName].push(s)}else o[n.nodeName]=s;return o}(t),e):{}}}};var D=M;function F(){if(!(this instanceof F))throw new TypeError("AltiResponse constructor cannot be called as a function.");this.elevations=[]}F.prototype={constructor:F};var k=F;function U(){if(!(this instanceof U))throw new TypeError("Elevation constructor cannot be called as a function.");this.z=null}U.prototype={constructor:U};var q=U,G={};G.READERS={elevations:function(e){var t=new k;if(e.hasChildNodes())for(var o,r,n=e.childNodes,s=0;s<n.length;s++)o=n[s],G.READERS[o.nodeName]&&(r=G.READERS[o.nodeName](o),t.elevations.push(r));return t},elevation:function(e){var t=new q;if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)o=r[n],G.READERS[o.nodeName]&&G.READERS[o.nodeName](o,t);return t},lat:function(e,t){var o=e.firstChild;if(!o||3!==o.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : latitude attendue mais absente");t.lat=parseFloat(o.nodeValue)},lon:function(e,t){var o=e.firstChild;if(!o||3!==o.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : longitude attendue mais absente");t.lon=parseFloat(o.nodeValue)},z:function(e,t){var o=e.firstChild;if(!o||3!==o.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : altitude attendue mais absente");if(!t)return(t=new q).z=parseFloat(o.nodeValue),t;t.z=parseFloat(o.nodeValue)},acc:function(e,t){var o=e.firstChild;if(!o||3!==o.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : précision (acc) attendue mais absente");t.acc=parseFloat(o.nodeValue)},exceptionreport:function(e){var t={};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)"Exception"===(o=r[n]).nodeName&&(t.exceptionReport=G.READERS.exception(o));return t},exception:function(e){var t={},o=e.getAttribute("exceptionCode");o&&(t.exceptionCode=o);var r=e.firstChild;return r&&3===r.nodeType&&(t.exception=r.nodeValue),t},error:function(e){var t={error:{}};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++){var s;1===(o=r[n]).nodeType&&"code"===o.nodeName&&(s=o.firstChild)&&3===s.nodeType&&(t.error.code=s.nodeValue),1===o.nodeType&&"description"===o.nodeName&&(s=o.firstChild)&&3===s.nodeType&&(t.error.description=s.nodeValue)}return t}},G.read=function(e){if("elevations"===e.nodeName)return G.READERS.elevations(e);if("ExceptionReport"===e.nodeName)return G.READERS.exceptionreport(e);if("error"===e.nodeName)return G.READERS.error(e);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")};var j=G;function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var X={build:function(e){var t=n.getLogger("AltiResponseFactory");t.trace(["AltiResponseFactory::build()"]);var o=null;if(e.response){if(e.rawResponse)t.trace("analyze response : raw"),o=e.response;else{switch(e.outputFormat){case"xml":t.trace("analyze response : xml");try{var r=new D({reader:j});if("string"==typeof e.response?r.setXMLString(e.response):r.setXMLDoc(e.response),!(o=r.parse()))throw new Error(s.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(t){var i=t.message;return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EXCEPTION",i),status:200,type:a.TYPE_SRVERR}))}break;case"json":t.trace("analyze response : json"),t.trace("analyze response : ",V(e.response));var l=null;if((l="string"==typeof e.response?JSON.parse(e.response):e.response)&&l.error)return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EXCEPTION",l.error.description),status:200,type:a.TYPE_SRVERR}));if(l){var c,u=l.elevations,p=new k;if(Array.isArray(u)&&u.length)for(var h=0;h<u.length;h++)c=new q,"object"===V(u[h])?(u[h].lon&&(c.lon=u[h].lon),u[h].lat&&(c.lat=u[h].lat),u[h].z&&(c.z=u[h].z),u[h].acc&&(c.acc=u[h].acc)):"number"==typeof u[h]&&(c.z=u[h]),Array.isArray(p.elevations)&&p.elevations.push(c);o=p}if(!o)return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:a.TYPE_UNKERR,status:-1}));break;default:return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_FORMAT_2"),type:a.TYPE_UNKERR,status:-1}))}if(o.exceptionReport)return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EXCEPTION",o.exceptionReport),type:a.TYPE_SRVERR,status:200}));if(o.error){var f=o.error.description;return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EXCEPTION",f),type:a.TYPE_SRVERR,status:200}))}}e.onSuccess.call(e.scope,o)}else e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_EMPTY")))}};function Y(e){if(!(this instanceof Y))throw new TypeError(s.getMessage("CLASS_CONSTRUCTOR","Alti"));if(this.CLASSNAME="Alti",_.apply(this,arguments),this.logger=n.getLogger("Gp.Services.Alti"),this.logger.trace("[Constructeur Alti (options)]"),!e.positions)throw new Error(s.getMessage("PARAM_MISSING","positions"));if(0===e.positions.length)throw new Error(s.getMessage("PARAM_EMPTY","positions"));if(this.options.positions=e.positions,this.options.outputFormat="string"==typeof e.outputFormat?e.outputFormat.toLowerCase():"xml",this.options.sampling=e.sampling||null,this.options.api="string"==typeof e.api?e.api.toUpperCase():"REST","REST"===this.options.api&&(this.options.httpMethod="GET"),this.options.zonly=e.zonly||!1,!this.options.serverUrl){var t=y.Alti.url(this.options.apiKey),o=null;switch(this.options.api){case"WPS":o=t.wps;break;case"REST":var r=(e.sampling?"profil":"elevation")+"-"+this.options.outputFormat;o=t[r];break;default:throw new Error(s.getMessage("PARAM_UNKNOWN","api"))}if(!o)throw new Error("Url by default not found !");this.options.serverUrl=o,this.logger.trace("Server URL by default : "+this.options.serverUrl)}var i=this.options.serverUrl.lastIndexOf(".");if(-1!==i){var a=this.options.serverUrl.substring(i+1);if(a&&a.length<5)switch(this.logger.trace("Server Extension URL : "+a),a.toLowerCase()){case"json":case"xml":this.options.outputFormat=a.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}Y.prototype=Object.create(_.prototype,{}),Y.prototype.constructor=Y,Y.prototype.buildRequest=function(e,t){var o={httpMethod:this.options.httpMethod,onSuccess:function(e){this.request=e,t.call(this,this.request)},onError:e,scope:this,positions:this.options.positions,outputFormat:this.options.outputFormat,sampling:this.options.sampling,api:this.options.api,zonly:this.options.zonly};I.build(o)},Y.prototype.analyzeResponse=function(e,t){if(this.response){var o={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:e,onSuccess:t,scope:this};X.build(o)}else e.call(this,new a(s.getMessage("SERVICE_RESPONSE_EMPTY")))};var H=Y;function z(){if(!(this instanceof z))throw new TypeError("AutoConfResponse constructor cannot be called as a function.");this.generalOptions={apiKeys:{},title:null,defaultGMLGFIStyle:null,theme:null,wgs84Resolutions:[]},this.layers={},this.territories={},this.tileMatrixSets={},this.services={}}z.prototype={constructor:z,isConfLoaded:function(e){if(e)return!!this.generalOptions.apiKeys[e]},getLayersId:function(e){return this.generalOptions.apiKeys[e]},getLayersConf:function(e){var t={},o=this.getLayersId(e);if(o)for(var r=0;r<o.length;r++){var n=o[r];t[n]=this.layers[n]}return t},getLayerConf:function(e){if(this.layers)return this.layers[e]},getTileMatrixSets:function(){return this.tileMatrixSets},getTMSConf:function(e){if(this.tileMatrixSets)return this.tileMatrixSets[e]},getTerritories:function(){return this.territories},getTerritoryConf:function(e){if(this.territories)return this.territories[e]},getServices:function(){return this.services},getServiceConf:function(e){if(this.services)return this.services[e]}};var K=z;function B(){if(!(this instanceof B))throw new TypeError("Constraint constructor cannot be called as a function.");this.crs=null,this.bbox={left:null,right:null,top:null,bottom:null},this.minScaleDenominator=null,this.maxScaleDenominator=null,this.temporalExtent=[null,null]}B.prototype={constructor:B};var W=B;function J(){if(!(this instanceof J))throw new TypeError("Format constructor cannot be called as a function.");this.current=null,this.name=null}J.prototype={constructor:J};var Q=J;function $(){if(!(this instanceof $))throw new TypeError("Layer constructor cannot be called as a function.")}$.prototype={constructor:$,getName:function(){return this.name},getTitle:function(){return this.title},getDescription:function(){return this.description},getLayerId:function(){return this.layerId},getQuicklookUrl:function(){return this.quicklookUrl},getDefaultProjection:function(){return this.defaultProjection},getProjections:function(){var e=[];return e.push(this.defaultProjection),e.concat(this.additionalProjections)},getBBOX:function(){if(this.globalConstraint)return this.globalConstraint.bbox},getMinScaleDenominator:function(){if(this.globalConstraint)return this.globalConstraint.minScaleDenominator},getMaxScaleDenominator:function(){if(this.globalConstraint)return this.globalConstraint.maxScaleDenominator},getTMSID:function(){if(this.wmtsOptions)return this.wmtsOptions.tileMatrixSetLink},getServiceParams:function(){return this.serviceParams},getServerUrl:function(e){if(e&&this.serviceParams&&this.serviceParams.serverUrl)return this.serviceParams.serverUrl[e]},getLegends:function(){return this.legends},getMetadata:function(){return this.metadata},getStyles:function(){return this.styles},getDefaultStyle:function(){if(this.styles){for(var e,t=this.styles,o=0;o<t.length;o++)if(!0===t[o].current){e=t[o].name;break}return e}},getThematics:function(){return this.thematics},getDefaultFormat:function(){if(this.formats){for(var e,t=this.formats,o=0;o<t.length;o++)if(!0===t[o].current){e=t[o].name;break}return e}},getConstraints:function(){return this.constraints},getOriginators:function(){return this.originators},getDimensions:function(){return this.dimensions},getAggregatedLayers:function(){if(this.isAggregate)return this.aggregatedLayers}};var Z=$;function ee(){if(!(this instanceof ee))throw new TypeError("Legend constructor cannot be called as a function.");this.format=null,this.url=null,this.minScaleDenominator=null}ee.prototype={constructor:ee};var te=ee;function oe(){if(!(this instanceof oe))throw new TypeError("Metadata constructor cannot be called as a function.");this.format=null,this.url=null}oe.prototype={constructor:oe};var re=oe;function ne(){if(!(this instanceof ne))throw new TypeError("Originator constructor cannot be called as a function.");this.name=null,this.attribution=null,this.logo=null,this.url=null,this.constraints=[]}ne.prototype={constructor:ne};var se=ne;function ie(){if(!(this instanceof ie))throw new TypeError("Service constructor cannot be called as a function.");this.title=null,this.serverUrl=null,this.version=null}ie.prototype={constructor:ie};var ae=ie;function le(){if(!(this instanceof le))throw new TypeError("Style constructor cannot be called as a function.");this.name=null,this.title=null,this.current=null,this.url=null}le.prototype={constructor:le};var ce=le;function ue(){if(!(this instanceof ue))throw new TypeError("Territory constructor cannot be called as a function.");this.isDefault=null,this.defaultCRS=null,this.additionalCRS=[],this.geoBBOX={left:null,right:null,top:null,bottom:null},this.geoCenter={lon:null,lat:null},this.defaultOptions={resolution:null,minScaleDenominator:null,maxScaleDenominator:null},this.defaultLayers=[]}ue.prototype={constructor:ue};var pe=ue;function he(){if(!(this instanceof he))throw new TypeError("Thematic constructor cannot be called as a function.");this.inspire=null,this.name=null}he.prototype={constructor:he};var fe=he;function ge(){if(!(this instanceof ge))throw new TypeError("TileMatrixSet constructor cannot be called as a function.");this.projection=null,this.nativeResolutions=[],this.matrixIds=[],this.tileMatrices={}}ge.prototype={constructor:ge,getResolutions:function(){return this.nativeResolutions},getMatrixIds:function(){return this.matrixIds},getProjection:function(){return this.projection},getTileMatrices:function(){return this.tileMatrices},getTopLeftCorner:function(){var e,t=this.getTileMatrices();if(t)for(var o in t)if(t.hasOwnProperty(o)){e=t[o].topLeftCorner;break}return e}};var de=ge;function me(){if(!(this instanceof me))throw new TypeError("TileMatrix constructor cannot be called as a function.");this.matrixId=null,this.matrixHeight=null,this.matrixWidth=null,this.scaleDenominator=null,this.tileHeight=null,this.tileWidth=null,this.topLeftCorner=null}me.prototype={constructor:me,getTopLeftCorner:function(){return this.topLeftCorner},getScaleDenominator:function(){return this.scaleDenominator},getTileHeight:function(){return this.tileHeight},getTileWidth:function(){return this.tileWidth},getMatrixHeight:function(){return this.matrixHeight},getMatrixWidth:function(){return this.matrixWidth}};var ye=me;function Ee(){if(!(this instanceof Ee))throw new TypeError("TileMatrixLimit constructor cannot be called as a function.");this.minTileRow=null,this.maxTileRow=null,this.minTileCol=null,this.maxTileCol=null}Ee.prototype={constructor:Ee};var ve=Ee;function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var we={};function Se(e,t){if(e.hasChildNodes())for(var o,r,n,s=e.childNodes,i=0;i<s.length;i++){if(1===(o=s[i]).nodeType)if(r=o.localName||o.baseName||o.nodeName,n=o.prefix||we.DEFAULTPREFIX,we.READERS[n][r])(0,we.READERS[n][r])(o,t);else Se(o,t)}}function Re(e){var t,o="";return e.hasChildNodes()&&(3!==(t=e.firstChild).nodeType&&4!==t.nodeType||(o=t.nodeValue)),o}we.VERSION="1.1.0",we.NAMESPACES={xmlns:"http://www.opengis.net/context",gpp:"http://api.ign.fr/geoportail",ows:"http://www.opengis.net/ows/2.0",sld:"http://www.opengis.net/sld",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},we.SCHEMALOCATION=["http://www.opengis.net/context http://wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf/autoconf.xsd","http://www.opengis.net/context http://wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf.xsd"],we.DEFAULTPREFIX="context",we.READERS={context:{ViewContext:function(e){!function(e){if(e.attributes.length>0){var t=function(e){if(e.attributes.length>0){for(var t={},o=e.attributes,r=0;r<o.length;r++){var n=o[r];t[n.nodeName]=n.nodeValue}return t}}(e);for(var o in t)if(t.hasOwnProperty(o)){if("version"===o&&t.version!==we.VERSION)return void console.log("[AutoConfResponseReader] autoconf version is not the expected one : there may be errors in parsing");if("xmlns"===o){if(t[o]!==we.NAMESPACES.xmlns)return void console.log("[AutoConfResponseReader] autoconf response default namespace is not the expected one");continue}var r=o.split(":")[0],n=o.split(":")[1];if("xmlns"===r&&n&&we.NAMESPACES[n]&&we.NAMESPACES[n]!==t[o])return void console.log("[AutoConfResponseReader] autoconf response "+o+" namespace is not the expected one");if("schemaLocation"===n&&t[o]!==we.SCHEMALOCATION[0]&&t[o]!==we.SCHEMALOCATION[1])return void console.log("[AutoConfResponseReader] autoconf response schema location is not the expected one")}}}(e);var t=new K;return Se(e,t),t},Title:function(e,t){t&&t.generalOptions?t.generalOptions.title=Re(e):t&&t.lyr&&(t.lyr.title=Re(e))},Abstract:function(e,t){t&&t.lyr&&(t.lyr.description=Re(e))},Server:function(e,t){var o=e.getAttribute("service"),r=e.getAttribute("title"),n=e.getAttribute("version");if(o)if(t&&t.services&&"object"===_e(t.services)&&!t.services[o]){var s=new ae;s.title=r,s.version=n,Se(e,s),t.services[o]=s}else t&&t.lyr&&(t.lyr.serviceParams||(t.lyr.serviceParams={}),t.lyr.serviceParams.id=o,t.lyr.serviceParams.version=n)},OnlineResource:function(e,t){t&&t.hasOwnProperty("serverUrl")&&(t.serverUrl=e.getAttribute("xlink:href"))},LayerList:function(e,t){if(Se(e,t),t&&t.layers&&t.generalOptions&&t.services)for(var o in t.layers)if(t.layers.hasOwnProperty(o)){var r=t.layers[o],n=r.apiKeys;if(n&&Array.isArray(n))for(var s=0;s<n.length;s++){var i=n[s];t.generalOptions.apiKeys&&(t.generalOptions.apiKeys[i]&&Array.isArray(t.generalOptions.apiKeys[i])||(t.generalOptions.apiKeys[i]=[]),t.generalOptions.apiKeys[i].push(o))}var a=r.serviceParams;if(a&&a.id&&!t.services[a.id]){var l=new ae;a.serverUrl&&(l.serverUrl=a.serverUrl),a.version&&(l.version=a.version),t.services[a.id]=l}if(r.wmtsOptions&&r.wmtsOptions.tileMatrixSetLink&&t.tileMatrixSets){var c=r.wmtsOptions.tileMatrixSetLink,u=t.tileMatrixSets;for(var p in u)u.hasOwnProperty(p)&&p===c&&(r.defaultProjection=u[p].projection)}}},Layer:function(e,t){if(t&&t.layers){var o={lyr:new Z,lyrId:null},r=e.getAttribute("hidden");o.lyr.hidden="1"===r;var n=e.getAttribute("queryable");if(o.lyr.queryable="1"===n,Se(e,o),o.lyrId){if(o.lyr.serviceParams&&o.lyr.serviceParams.id){var s=o.lyr.serviceParams.id;if(-1!==s.toUpperCase().indexOf("OPENLS")||-1!==s.toUpperCase().indexOf("ELEVATION")){var i=o.lyrId.split("$")[0];o.lyrId=i+"$"+s}}o.lyr.layerId=o.lyrId,t.layers[o.lyrId]=o.lyr}}},Name:function(e,t){t&&t.lyr&&(t.lyr.name=Re(e))},SRS:function(e,t){t&&t.lyr&&(t.lyr.defaultProjection=Re(e))},Format:function(e,t){if(t&&t.lyr){var o=new Q,r=e.getAttribute("current");o.current="1"===r,o.name=Re(e),t.lyr.formats&&Array.isArray(t.lyr.formats)||(t.lyr.formats=[]),t.lyr.formats.push(o)}},Style:function(e,t){if(t&&t.lyr){var o=new ce,r=e.getAttribute("current");if(o.current="1"===r||1===r,e.hasChildNodes)for(var n,s,i=e.childNodes,a=0;a<i.length;a++)1===(n=i[a]).nodeType&&("Name"===(s=n.localName||n.baseName||n.nodeName)?o.name=Re(n):"Title"===s?o.title=Re(n):"URL"===s&&(o.url=Re(n)));t.lyr.styles&&Array.isArray(t.lyr.styles)||(t.lyr.styles=[]),t.lyr.styles.push(o)}},Dimension:function(e,t){var o=e.getAttribute("name"),r=Re(e);t&&t.lyr&&(t.lyr.dimensions||(t.lyr.dimensions={}),"Type"===o?t.lyr.dimensions.type=r:"VisibilityRange"===o?t.lyr.dimensions.visibilityRange=r:"VisibilityMode "===o?t.lyr.dimensions.visibilityMode=r:"GeometricType"===o?t.lyr.dimensions.geometricType=r:"NoDataValue"===o&&(t.lyr.dimensions.noDataValue=r))}},gpp:{Theme:function(e,t){t&&t.generalOptions&&t.generalOptions.hasOwnProperty("theme")&&(t.generalOptions.theme=Re(e))},defaultGMLGFIStyleUrl:function(e,t){t&&t.generalOptions&&t.generalOptions.hasOwnProperty("defaultGMLGFIStyle")&&(t.generalOptions.defaultGMLGFIStyle=Re(e))},Territory:function(e,t){var o=e.getAttribute("id");if(o){var r=new pe,n=e.getAttribute("default");r.isDefault="1"===n,Se(e,r),t&&t.territories&&"object"===_e(t.territories)&&(t.territories[o]=r)}},defaultCRS:function(e,t){t&&t.hasOwnProperty("defaultCRS")&&(t.defaultCRS=Re(e))},AdditionalCRS:function(e,t){var o=Re(e);o&&t&&(Array.isArray(t.additionalCRS)?t.additionalCRS.push(o):(t.additionalProjections&&Array.isArray(t.additionalProjections)||(t.additionalProjections=[]),t.additionalProjections.push(o)))},DefaultLayer:function(e,t){var o=e.getAttribute("layerId");o&&t&&Array.isArray(t.defaultLayers)&&t.defaultLayers.push(o)},BoundingBox:function(e,t){if(t){var o=Re(e).split(",");if(4===o.length){var r={left:parseFloat(o[0]),right:parseFloat(o[2]),top:parseFloat(o[3]),bottom:parseFloat(o[1])},n=e.getAttribute("minT"),s=e.getAttribute("maxT");if(t.hasOwnProperty("geoBBOX"))t.geoBBOX=r;else if(t.hasOwnProperty("bbox"))if(t.bbox.left||t.bbox.right||t.bbox.top||t.bbox.bottom){t.multiConstraints||(t.multiConstraints=[]);var i=new W;i.bbox=r,i.temporalExtent=[n,s],t.multiConstraints.push(i)}else t.bbox=r,t.temporalExtent=[n,s];else t.globalConstraint||(t.globalConstraint=new W),t.globalConstraint.bbox=r,t.globalConstraint.temporalExtent=[n,s]}}},Resolution:function(e,t){var o=Re(e);o&&t&&t.defaultOptions&&t.defaultOptions.hasOwnProperty("resolution")&&(t.defaultOptions.resolution=parseFloat(o))},x:function(e,t){var o=Re(e);o&&t&&t.geoCenter&&t.geoCenter.hasOwnProperty("lon")&&(t.geoCenter.lon=parseFloat(o))},y:function(e,t){var o=Re(e);o&&t&&t.geoCenter&&t.geoCenter.hasOwnProperty("lat")&&(t.geoCenter.lat=parseFloat(o))},Resolutions:function(e,t){t&&t.generalOptions&&t.generalOptions.hasOwnProperty("wgs84Resolutions")&&(t.generalOptions.wgs84Resolutions=Re(e).split(","))},Layer:function(e,t){if(t&&t.hasOwnProperty("lyrId")&&t.lyr){t.lyrId=e.getAttribute("id");var o=e.getAttribute("aggregate"),r=e.getAttribute("more");(o||r)&&(t.lyr.isAggregate=!0),Se(e,t.lyr)}},Constraint:function(e,t){var o=new W;if(Se(e,o),t)if(t.constraints&&Array.isArray(t.constraints)||(t.constraints=[]),o.multiConstraints&&Array.isArray(o.multiConstraints)){var r=new W;r.crs=o.crs,r.bbox=o.bbox,r.minScaleDenominator=o.minScaleDenominator,r.maxScaleDenominator=o.maxScaleDenominator,r.temporalExtent=o.temporalExtent,t.constraints.push(r);for(var n=0;n<o.multiConstraints.length;n++)(r=new W).crs=o.crs,r.minScaleDenominator=o.minScaleDenominator,r.maxScaleDenominator=o.maxScaleDenominator,r.bbox=o.multiConstraints[n].bbox,r.temporalExtent=o.multiConstraints[n].temporalExtent,t.constraints.push(r)}else t.constraints.push(o)},CRS:function(e,t){t&&t.hasOwnProperty("crs")&&(t.crs=Re(e))},Thematic:function(e,t){if(t){var o=new fe;o.inspire=!1,o.name=Re(e),t.thematics&&Array.isArray(t.thematics)||(t.thematics=[]),t.thematics.push(o)}},InspireThematic:function(e,t){if(t){var o=new fe;o.inspire=!0,o.name=Re(e),t.thematics&&Array.isArray(t.thematics)||(t.thematics=[]),t.thematics.push(o)}},Originator:function(e,t){if(t){var o=new se;o.name=e.getAttribute("name"),Se(e,o),t.originators&&Array.isArray(t.originators)||(t.originators=[]),t.originators.push(o)}},Attribution:function(e,t){t&&t.hasOwnProperty("attribution")&&(t.attribution=Re(e))},Logo:function(e,t){t&&t.hasOwnProperty("logo")&&(t.logo=Re(e))},URL:function(e,t){t&&t.hasOwnProperty("url")&&(t.url=Re(e))},Legend:function(e,t){var o=new te;Se(e,o),t&&(t.legends&&Array.isArray(t.legends)||(t.legends=[]),t.legends.push(o))},LegendURL:function(e,t){if(t&&t.hasOwnProperty("format")&&(t.format=e.getAttribute("format"),e.hasChildNodes)){var o=e.childNodes[0];"OnlineResource"===(o.localName||o.baseName||o.nodeName)&&t.hasOwnProperty("url")&&(t.url=o.getAttribute("xlink:href"))}},QuickLook:function(e,t){if(e.hasChildNodes){var o=e.childNodes[0];"OnlineResource"===(o.localName||o.baseName||o.nodeName)&&t&&(t.quicklookUrl=o.getAttribute("xlink:href"))}},MetadataURL:function(e,t){if(t){var o=new re;if(o.format=e.getAttribute("format"),e.hasChildNodes){var r=e.childNodes[0];"OnlineResource"===(r.localName||r.baseName||r.nodeName)&&(o.url=r.getAttribute("xlink:href"))}t.metadata||(t.metadata=[]),t.metadata.push(o)}},Key:function(e,t){if(t){var o=e.getAttribute("id");t.apiKeys&&Array.isArray(t.apiKeys)||(t.apiKeys=[]),t.apiKeys.push(o);var r=Re(e);t.serviceParams||(t.serviceParams={}),t.serviceParams.serverUrl||(t.serviceParams.serverUrl={}),t.serviceParams.serverUrl[o]||(t.serviceParams.serverUrl[o]=r)}}},ows:{Identifier:function(e,t){t&&t.hasOwnProperty("TMS")?t.identifier=Re(e):t&&t.hasOwnProperty("matrixId")&&(t.matrixId=Re(e))},SupportedCRS:function(e,t){t&&t.TMS&&t.TMS.hasOwnProperty("projection")&&(t.TMS.projection=Re(e))}},sld:{MinScaleDenominator:function(e,t){var o=Re(e);o&&t&&(t.hasOwnProperty("defaultOptions")?t.defaultOptions.minScaleDenominator=parseFloat(o):t.lyr?(t.lyr.globalConstraint||(t.lyr.globalConstraint=new W),t.lyr.globalConstraint.minScaleDenominator=parseFloat(o)):t.hasOwnProperty("minScaleDenominator")&&(t.minScaleDenominator=parseFloat(o)))},MaxScaleDenominator:function(e,t){var o=Re(e);o&&t&&(t.hasOwnProperty("defaultOptions")?t.defaultOptions.maxScaleDenominator=parseFloat(o):t.lyr?(t.lyr.globalConstraint||(t.lyr.globalConstraint=new W),t.lyr.globalConstraint.maxScaleDenominator=parseFloat(o)):t.hasOwnProperty("maxScaleDenominator")&&(t.maxScaleDenominator=parseFloat(o)))}},wmts:{TileMatrixSetLimits:function(e,t){if(t){var o={};Se(e,o),t.wmtsOptions||(t.wmtsOptions={}),t.wmtsOptions.tileMatrixSetLimits=o}},TileMatrixLimits:function(e,t){var o,r=new ve;if(e.hasChildNodes){for(var n=e.childNodes,s=0;s<n.length;s++){var i=n[s],a=i.localName||i.baseName||i.nodeName;"TileMatrix"===a?o=Re(i):"MinTileRow"===a?r.minTileRow=Re(i):"MaxTileRow"===a?r.maxTileRow=Re(i):"MinTileCol"===a?r.minTileCol=Re(i):"MaxTileCol"===a&&(r.maxTileCol=Re(i))}o&&t&&!t[o]&&(t[o]=r)}},TileMatrixSet:function(e,t){if(t&&t.tileMatrixSets){var o={};o.TMS=new de,o.resolutions=[],Se(e,o);var r=o.TMS.tileMatrices;for(var n in r)r.hasOwnProperty(n)&&o.TMS.matrixIds.push(n);if(("IGNF:WGS84G"===o.TMS.getProjection()||"EPSG:4326"===o.TMS.getProjection())&&t.generalOptions&&Array.isArray(t.generalOptions.wgs84Resolutions))for(var s=t.generalOptions.wgs84Resolutions,i=0;i<s.length;i++)o.resolutions[i]=parseFloat(s[i]);Array.isArray(o.resolutions)&&void 0!==o.resolutions.sort&&o.resolutions.sort((function(e,t){return t-e})),o.TMS.nativeResolutions=o.resolutions,t.tileMatrixSets[o.identifier]=o.TMS}else t&&!t.wmtsOptions&&(t.wmtsOptions={}),t.wmtsOptions.tileMatrixSetLink=Re(e)},TileMatrix:function(e,t){if(t){var o=new ye;if(Se(e,o),t.TMS&&t.TMS.getProjection()){var r=t.TMS.getProjection();if("EPSG:3857"===r||"EPSG:2154"===r){var n=28e-5*o.scaleDenominator;t.resolutions&&Array.isArray(t.resolutions)&&t.resolutions.push(n)}}t.TMS&&t.TMS.tileMatrices&&(t.TMS.tileMatrices[o.matrixId]=o)}},ScaleDenominator:function(e,t){var o=Re(e);o&&t&&t.hasOwnProperty("scaleDenominator")&&(t.scaleDenominator=parseFloat(o))},TopLeftCorner:function(e,t){var o=Re(e).split(" ");o&&t&&(t.topLeftCorner={},t.topLeftCorner.x=parseFloat(o[0]),t.topLeftCorner.y=parseFloat(o[1]))},TileWidth:function(e,t){var o=Re(e);o&&t&&t.hasOwnProperty("tileWidth")&&(t.tileWidth=parseInt(o,10))},TileHeight:function(e,t){var o=Re(e);o&&t&&t.hasOwnProperty("tileHeight")&&(t.tileHeight=parseInt(o,10))},MatrixWidth:function(e,t){var o=Re(e);o&&t&&t.hasOwnProperty("matrixWidth")&&(t.matrixWidth=parseInt(o,10))},MatrixHeight:function(e,t){var o=Re(e);o&&t&&t.hasOwnProperty("matrixHeight")&&(t.matrixHeight=parseInt(o,10))}},serviceException:function(e){var t={};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)"exception"===(o=r[n]).nodeName&&(t.exceptionReport=we.READERS.exception(o));return t},exception:function(e){var t={},o=e.getAttribute("code");o&&(t.exceptionCode=o);var r=e.firstChild;return r&&3===r.nodeType&&(t.exception=r.nodeValue),t}},we.read=function(e){if("ViewContext"===e.nodeName){var t=e.prefix||we.DEFAULTPREFIX;return we.READERS[t][e.nodeName](e)}if("serviceException"===e.nodeName)return we.READERS[e.nodeName](e);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")};var be=we,Ae={build:function(e){n.getLogger("AutoConfResponseFactory").trace(["AutoConfResponseFactory::build()"]);var t=null;if(e.response){if(e.rawResponse)t=e.response;else{try{var o=new D({reader:be});"string"==typeof e.response?o.setXMLString(e.response):o.setXMLDoc(e.response),t=o.parse()}catch(t){var r=t.message;return"string"==typeof e.response?r+="\n (raw response service'"+e.response+"')":r+="\n (raw response service'"+e.response.documentElement.innerHTML+"')",void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EXCEPTION",r),status:200,type:a.TYPE_SRVERR}))}var i=!0;for(var l in t)t.hasOwnProperty(l)&&(i=!1);if(i)return void e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_EMPTY_2")));if(t.exceptionReport)return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EXCEPTION",t.exceptionReport),type:a.TYPE_SRVERR,status:200}))}var c="undefined"!=typeof window?window:{};c.Gp||(c.Gp={}),c.Gp.Config?this.mergeConfig(c.Gp.Config,t,e.layerId):c.Gp.Config=t,e.onSuccess.call(e.scope,c.Gp.Config)}else e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_EMPTY")))},mergeConfig:function(e,t,o){if(t&&e){for(var r in t)if(t.hasOwnProperty(r))if("generalOptions"===r)for(var n in t[r].apiKeys)t[r].apiKeys.hasOwnProperty(n)&&!e.generalOptions.apiKeys[n]&&(e.generalOptions.apiKeys[n]=t[r].apiKeys[n]);else if(e[r])for(var s in t[r])t[r].hasOwnProperty(s)&&!e[r][s]&&(e[r][s]=t[r][s]);if(o){var i=[];for(var a in t.layers)t.layers.hasOwnProperty(a)&&i.push(a);e.layers[o]&&(e.layers[o].aggregatedLayers=i)}}}};function Te(e){if(!(this instanceof Te))throw new TypeError(s.getMessage("CLASS_CONSTRUCTOR","AutoConf"));if(this.CLASSNAME="AutoConf",e||(e={}),e.protocol=e.protocol||"JSONP",_.apply(this,arguments),this.logger=n.getLogger("Gp.Services.AutoConf"),this.logger.trace("[Constructeur AutoConf (options)]"),("string"==typeof this.options.apiKey||this.options.apiKey instanceof String)&&Array.isArray(this.options.apiKey.split(","))&&this.options.apiKey.split(",").length>1&&(this.options.apiKey=this.options.apiKey.split(",")),!this.options.serverUrl&&!this.options.serverUrl){var t=y.AutoConf.url(this.options.apiKey);this.options.layerId?this.options.serverUrl=t.aggregate+this.options.layerId:Array.isArray(this.options.apiKey)&&this.options.apiKey.length>0?this.options.serverUrl=t.apiKeys:this.options.serverUrl=t.apiKey}"XHR"===this.options.protocol&&"POST"===this.options.httpMethod&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"xml"}Te.prototype=Object.create(_.prototype,{}),Te.prototype.constructor=Te,Te.prototype.buildRequest=function(e,t){var o="undefined"!=typeof window?window:{};if(o.Gp&&o.Gp.Config&&o.Gp.Config.generalOptions&&o.Gp.Config.layers&&o.Gp.Config.generalOptions.apiKeys[this.options.apiKey]){if(!this.options.layerId)return this.logger.warn("Gp.Config existe déjà pour cette clé"),void this.options.onSuccess.call(this,o.Gp.Config);if(o.Gp.Config.layers[this.options.layerId]&&o.Gp.Config.layers[this.options.layerId].aggregatedLayers)return this.logger.warn("Gp.Config existe déjà pour cette clé et cette couche"),void this.options.onSuccess.call(this,o.Gp.Config)}this.request="",!(-1===this.options.serverUrl.indexOf("http://"))&&this.layerId&&(this.request=l.normalyzeParameters({layerId:this.layerId})),this.request||""===this.request?t.call(this,this.request):e.call(this,new a(s.getMessage("SERVICE_REQUEST_BUILD")))},Te.prototype.analyzeResponse=function(e,t){if(this.response){var o={layerId:this.options.layerId,response:this.response,rawResponse:this.options.rawResponse,onSuccess:t,onError:e,scope:this};Ae.build(o)}else e.call(this,new a(s.getMessage("SERVICE_RESPONSE_EMPTY")))};var Oe=Te;function Pe(e){if(this.logger=n.getLogger(),this.logger.trace("[Constructeur RequestHeader ()]"),!(this instanceof Pe))throw new TypeError("RequestHeader constructor cannot be called as a function.");for(var t in this.options=e||{srsName:"EPSG:4326"},e)e.hasOwnProperty(t)&&(this.options[t]=e[t])}Pe.prototype={requestString:null,template:'<RequestHeader srsName="__SRSNAME__"/>',constructor:Pe,toString:function(){var e=null;return e=(e=this.template).replace(/__SRSNAME__/g,this.options.srsName),this.requestString=e,this.requestString}};var xe=Pe;function Ce(e){if(this.logger=n.getLogger(),this.logger.trace("[Constructeur Request ()]"),!(this instanceof Ce))throw new TypeError("Request constructor cannot be called as a function.");for(var t in this.options=e||{maximumResponses:25,methodName:null,version:"1.2"},e)e.hasOwnProperty(t)&&(this.options[t]=e[t])}Ce.prototype={requestString:null,template:'<Request maximumResponses="__MAXRESPONSES__" methodName="__METHODNAME__" requestID="__UUID__" version="__VERSION__">\x3c!-- __REQUESTSERVICE__ --\x3e</Request>',constructor:Ce,guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},toString:function(){var e=null;return e=(e=(e=(e=(e=this.template).replace(/__MAXRESPONSES__/g,this.options.maximumResponses)).replace(/__METHODNAME__/g,this.options.methodName)).replace(/__UUID__/g,this.guid())).replace(/__VERSION__/g,this.options.version),this.requestString=e,this.requestString}};var Ne=Ce;function Ie(e){if(this.logger=n.getLogger(),this.logger.trace("[Constructeur AbstractService ()]"),!(this instanceof Ie))throw new TypeError("AbstractService constructor cannot be called as a function.");for(var t in this.options=e||{},e)e.hasOwnProperty(t)&&(this.options[t]=e[t])}Ie.prototype={strRequest:null,oRequest:null,oFilter:null,constructor:Ie,addRequest:function(e){this.logger.error("overwritten method !")},addFilter:function(e){this.logger.error("overwritten method !")},toString:function(){this.logger.error("overwritten method !")}};var Me=Ie;function Le(e){if(this.logger=n.getLogger(),this.logger.trace("[Constructeur XLS()]"),!(this instanceof Le))throw new TypeError("XLS constructor cannot be called as a function.");for(var t in this.options={srsName:"EPSG:4326",maximumResponses:25},e)e.hasOwnProperty(t)&&e[t]&&(this.options[t]=e[t])}Le.VERSION="1.2",Le.prototype={requestString:null,namespace:!1,oService:null,constructor:Le,template:'<?xml version="1.0" encoding="UTF-8"?>\n<XLS version="__VERSION__"\n__NAMESPACE__ \n__SCHEMALOCATION__>\n__REQUESTHEADER__\n__REQUEST__\n</XLS>\n',namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns:xls="http://www.opengis.net/xls"','xmlns:gml="http://www.opengis.net/gml"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/xls http://schemas.opengis.net/ols/1.2/olsAll.xsd"'},setService:function(e){e?e instanceof Me?this.oService=e:this.logger.error("L'objet n'est pas du type 'LocationUtilityService' ou 'RouteService' !?"):this.logger.trace("L'objet de type Service XSL n'est pas encore defini !?")},getService:function(){return this.oService}},Le.prototype.addNamespace=function(e,t){for(var o,r,n=e.key,s=!1,i=this.namespaceByDefault().split(" "),a=0;a<i.length;a++){if(i[a].split("=")[0]==="xmlns:"+n){s=!0;break}}return s?(o=/<(\w+[\s>])/g,r="<"+n+":$1",t=t.replace(o,r),o=/<\/(\w+[\s>])/g,r="</"+n+":$1",t=t.replace(o,r),this.logger.trace("namespace",t),t):(this.logger.warn("L'ajout d'un nouvel namespace n'est pas encore implémenté !"),t)},Le.prototype.build=function(){var e=!!this.getService(),t="";t=(t=(t=(t=this.template).replace(/__VERSION__/g,Le.VERSION)).replace(/__NAMESPACE__/g,this.namespaceByDefault)).replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault);var o=new xe({srsName:this.options.srsName});t=t.replace(/__REQUESTHEADER__/g,o.toString());var r=new Ne({maximumResponses:this.options.maximumResponses,version:Le.VERSION,methodName:e?this.getService().CLASSTYPE:null});if(t=t.replace(/__REQUEST__/g,r.toString()),e&&(t=t.replace(/<!-- __REQUESTSERVICE__ -->/g,this.getService().toString())),t)return this.namespace&&(t=this.addNamespace({key:"xls",url:"http://www.opengis.net/xls"},t)),this.requestString=t,this.logger.trace("traduction tmpl",t),this.requestString;this.logger.warn("traduction tmpl : empty request !?")};var De=Le;function Fe(e){if(this.logger=n.getLogger("Address"),this.logger.trace("[Constructeur Address ()]"),!(this instanceof Fe))throw new TypeError("Address constructor cannot be called as a function.");if(this.options=e||{location:{},type:["StreetAddress"],filter:{}},!this.options.location||0===Object.keys(this.options.location).length)throw new Error("l'option 'location' n'est pas renseignée !")}Fe.prototype={constructor:Fe,requestString:null,template:{address:'<Address countryCode="__COUNTRYCODE__">__LOCATION____PLACE____POSTALCODE____ENVELOPE__</Address>',location:{freeFormAddress:"<freeFormAddress>__FREEFORMADDRESSVALUE__</freeFormAddress>",streetAddress:{container:"<StreetAddress>__STREET____BUILDING__</StreetAddress>",building:'<Building number="__BUILDINGVALUE__"/>',street:"<Street>__STREETVALUE__</Street>"}},place:'<Place type="__PLACETYPE__">__PLACEVALUE__</Place>',postalCode:"<PostalCode>__POSTALCODEVALUE__</PostalCode>",envelope:"<gml:Envelope><gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner><gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner></gml:Envelope>"}},Fe.prototype.toString=function(){var e=null;if(e=(e=this.template.address).replace(/__COUNTRYCODE__/g,this.options.type),"string"==typeof this.options.location){var t=this.template.location.freeFormAddress;t=t.replace(/__FREEFORMADDRESSVALUE__/g,this.options.location),e=e.replace(/__LOCATION__/g,t)}else{var o="",r="";this.options.location.number&&(o=(o=this.template.location.streetAddress.building).replace(/__BUILDINGVALUE__/g,this.options.location.number)),this.options.location.street&&(r=(r=this.template.location.streetAddress.street).replace(/__STREETVALUE__/g,this.options.location.street));var n=this.template.location.streetAddress.container;n=(n=n.replace(/__STREET__/g,r)).replace(/__BUILDING__/g,o),e=e.replace(/__LOCATION__/g,n)}var s="";this.options.location.postalCode&&(s=(s=this.template.postalCode).replace(/__POSTALCODEVALUE__/g,this.options.location.postalCode));var i="";if(this.options.filter){var a=this.options.filter.bbox;a&&(i=(i=(i=(i=(i=this.template.envelope).replace(/__LEFT__/g,a.left)).replace(/__BOTTOM__/g,a.bottom)).replace(/__RIGHT__/g,a.right)).replace(/__TOP__/g,a.top))}var l=[],c="";if(this.options.filter){var u=this.options.filter;for(var p in u)"bbox"!==p&&(c=(c=(c=this.template.place).replace(/__PLACETYPE__/g,p)).replace(/__PLACEVALUE__/g,u[p]),l.push(c))}var h="";return this.options.location.city&&(h=(h=(h=this.template.place).replace(/__PLACETYPE__/g,"Municipality")).replace(/__PLACEVALUE__/g,this.options.location.city),l.push(h)),e=(e=(e=e.replace(/__POSTALCODE__/g,s)).replace(/__PLACE__/g,l.join("\n"))).replace(/__ENVELOPE__/g,i),this.requestString=e,this.requestString};var ke=Fe;function Ue(){if(this.logger=n.getLogger("GeocodeFilterExtension"),this.logger.trace("[Constructeur GeocodeFilterExtension ()]"),!(this instanceof Ue))throw new TypeError("GeocodeFilterExtension constructor cannot be called as a function.");this.filters=[]}Ue.prototype={constructor:Ue,addFilterExtensions:function(e){e&&this.filters.push(e)},getNames:function(){var e=[];for(var t in this.filters)e.push(this.filters[t].CLASSNAME);return this.logger.trace(e),e},getFilter:function(e){var t=null;for(var o in this.filters)this.filters[o].CLASSNAME===e&&(t=this.filters[o]);return this.logger.trace(t),t},getFilters:function(){return this.logger.trace(this.filters),this.filters},getAttributs:function(e){var t=[];for(var o in this.filters)this.filters[o].CLASSNAME===e&&(t=this.filters[o].attributesList);return this.logger.trace(t),t},setPlaceAttributs:function(e,t){var o=this.getFilter(e),r=this.getAttributs(e);for(var n in r){var s=r[n];t[s]&&(o.placeAttributes[s]=t[s])}},getPlaceAttributs:function(e){var t={};for(var o in this.filters)this.filters[o].CLASSNAME===e&&(t=this.filters[o].placeAttributes);return this.logger.trace(t),t}};var qe=Ue;function Ge(e){if(this.logger=n.getLogger(),this.logger.trace("[Constructeur GeocodeRequest ()]"),!(this instanceof Ge))throw new TypeError("GeocodeRequest constructor cannot be called as a function.");for(var t in this.options=e||{},e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);this.CLASSNAME="GeocodeRequest"}Ge.prototype={strRequest:null,oAddress:null,oFilter:null,template:'<GeocodeRequest returnFreeForm="__RETURNFREEFORM__">__ADDRESS__</GeocodeRequest>',addAddress:function(e){e instanceof ke&&(this.oAddress=e)},addFilter:function(e){e instanceof qe&&(this.oFilter=e)},constructor:Ge,toString:function(){var e="";if(e=this.template,!this.oAddress){var t={};if(t.location=this.options.location,t.type=this.options.filterOptions.type||["StreetAddress"],t.filter=this.options.filterOptions,delete t.filter.type,this.oFilter)for(var o in t.filter={},t.type){var r=t.type[o],n=this.oFilter.getFilter(r);if(n){for(var s=this.options.filterOptions,i=n.attributesList,a=0;a<i.length;a++){var l=i[a];if(s[l]){var c=n.serviceAttributes[a];n.placeAttributes[c]=s[l],this.logger.trace("Selection du filtre '"+l+"' sur le type '"+r+"'.")}}var u=n.placeAttributes;for(var p in u)u.hasOwnProperty(p)&&(t.filter[p]=u[p])}else this.logger.warn("Le filtre '"+r+"' n'existe pas !?")}if(this.oAddress=new ke(t),!this.oAddress)throw new Error("La construction de l'adresse n'est pas correctement definie !?")}return e=(e=e.replace(/__ADDRESS__/g,this.oAddress.toString())).replace(/__RETURNFREEFORM__/g,this.options.returnFreeForm?"true":"false"),this.strRequest=e,this.strRequest}};var je=Ge;function Ve(e){if(this.logger=n.getLogger("Position"),this.logger.trace("[Constructeur Position ()]"),!(this instanceof Ve))throw new TypeError("Position constructor cannot be called as a function.");if(this.options=e||{},!this.options.position)throw new Error("l'option 'position' n'est pas renseignée !")}Ve.prototype={constructor:Ve,requestString:null,template:{position:"<Position>__GMLPOINT____GMLFILTER__</Position>",gml:{point:'<gml:Point xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos></gml:Point>',pos:null,filter:{bbox:'<gml:Envelope xmlns:gml="http://www.opengis.net/gml"><gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner><gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner></gml:Envelope>',circle:'<gml:CircleByCenterPoint xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos><gml:radius>__RADIUS__</gml:radius></gml:CircleByCenterPoint>',polygon:'<gml:Polygon xmlns:gml="http://www.opengis.net/gml"><gml:exterior><gml:LinearRing><gml:posList>__XY__</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>',multipolygon:null}}}},Ve.prototype.toString=function(){var e=this.template.position,t=this.template.gml.point;t=(t=t.replace(/__X__/g,this.options.position.x)).replace(/__Y__/g,this.options.position.y);var o="";if(this.options.filter){var r=this.options.filter;for(var n in r)switch(n){case"circle":o=(o=(o=(o=this.template.gml.filter[n]).replace(/__X__/g,r[n].x)).replace(/__Y__/g,r[n].y)).replace(/__RADIUS__/g,r[n].radius);break;case"bbox":o=(o=(o=(o=(o=this.template.gml.filter[n]).replace(/__LEFT__/g,r[n].left)).replace(/__BOTTOM__/g,r[n].bottom)).replace(/__RIGHT__/g,r[n].right)).replace(/__TOP__/g,r[n].top);break;case"polygon":o=this.template.gml.filter[n];for(var s="",i=r[n],a=0;a<i.length;a++){var l=i[a];if(Array.isArray(l)){this.logger.error("Holes are not implemented !");break}(l.x&&l.y||0===l.x||0===l.y)&&(s+=l.x+" "+l.y),i.length!==a+1&&(s+=" ")}o=o.replace(/__XY__/g,s);break;case"multipolygon":this.logger.warn("Filter '"+n+"' is not yet implemented !");break;default:this.logger.error("This filter '"+n+"' is not useful !")}}return e=(e=e.replace(/__GMLPOINT__/g,t)).replace(/__GMLFILTER__/g,o),this.requestString=e,this.requestString};var Xe=Ve;function Ye(e){if(this.logger=n.getLogger("Preference"),this.logger.trace("[Constructeur Preference ()]"),!(this instanceof Ye))throw new TypeError("Preference constructor cannot be called as a function.");this.type=e}Ye.prototype={constructor:Ye,requestString:null,template:"<ReverseGeocodePreference>__TYPE__</ReverseGeocodePreference>"},Ye.prototype.toString=function(){for(var e=[],t="",o=0;o<this.type.length;o++)t=(t=this.template).replace(/__TYPE__/g,this.type[o]),e.push(t);return this.strRequest=e.join("\n"),this.strRequest};var He=Ye;function ze(e){if(this.logger=n.getLogger(),this.logger.trace("[Constructeur ReverseGeocodeRequest ()]"),!(this instanceof ze))throw new TypeError("ReverseGeocodeRequest constructor cannot be called as a function.");for(var t in this.options=e||{},e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);this.CLASSNAME="ReverseGeocodeRequest"}ze.prototype={strRequest:null,oPosition:null,oPreference:null,constructor:ze,template:'<ReverseGeocodeRequest returnFreeForm="__RETURNFREEFORM__">__POSITION____PREFERENCE__</ReverseGeocodeRequest>',addPosition:function(e){e instanceof Xe&&(this.oPosition=e)},addPreferences:function(e){e instanceof He&&(this.oPreference=e)},toString:function(){var e="";if(e=this.template,!this.oPreference&&(this.oPreference=new He(this.options.filterOptions.type||["StreetAddress"]),!this.oPreference))throw new Error("Les preferences ne sont pas definies !?");if(e=e.replace(/__PREFERENCE__/g,this.oPreference.toString()),!this.oPosition){var t={position:this.options.position,filter:{}};if(this.options.filterOptions&&(t.filter=this.options.filterOptions,delete t.filter.type),this.oPosition=new Xe(t),!this.oPosition)throw new Error("La position et ses filtres ne sont pas definis !?")}return e=(e=e.replace(/__POSITION__/g,this.oPosition.toString())).replace(/__RETURNFREEFORM__/g,this.options.returnFreeForm?"true":"false"),this.strRequest=e,this.strRequest}};var Ke=ze;function Be(e){if(this.logger=n.getLogger(),this.logger.trace("[Constructeur LocationUtilityService ()]"),!(this instanceof Be))throw new TypeError("LocationUtilityService constructor cannot be called as a function.");this.CLASSNAME="LocationUtilityService",this.CLASSTYPE=null,Me.apply(this,arguments),this.options&&(this.CLASSTYPE=this.options.location?"GeocodeRequest":this.options.position?"ReverseGeocodeRequest":null)}Be.prototype=Object.create(Me.prototype,{}),Be.prototype.constructor=Be,Be.prototype.addRequest=function(e){switch(this.CLASSTYPE=e.CLASSNAME,this.CLASSTYPE){case"GeocodeRequest":case"ReverseGeocodeRequest":this.oRequest=e;break;default:throw new Error("Ce n'est pas un objet de type 'LUS Request' !?")}},Be.prototype.addFilter=function(e){e instanceof qe&&(this.oFilter=e)},Be.prototype.toString=function(){if(!this.oRequest){if(!this.options)throw new Error("Les options ne sont pas renseignées, impossible de construire la requête !");if("GeocodeRequest"===this.CLASSTYPE){var e={location:this.options.location,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions||{}};this.oRequest=new je(e),this.oFilter&&this.oRequest.addFilter(this.oFilter)}else if("ReverseGeocodeRequest"===this.CLASSTYPE){var t={position:this.options.position,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions||{}};this.oRequest=new Ke(t)}else this.logger.error("impossible de determiner le type de geocodage : Direct ou Inverse !?")}if(!this.oRequest)throw new Error("Type de Geocodage indefini !");return this.strRequest=this.oRequest.toString(),this.strRequest};var We=Be;function Je(){if(!(this instanceof Je))throw new TypeError("GeocodeLocation constructor cannot be called as a function.");this.placeAttributes={},this.attributesList=[],this.serviceAttributes=[]}Je.prototype={constructor:Je};var Qe=Je;function $e(){if(!(this instanceof $e))throw new TypeError("StreetAddress constructor cannot be called as a function.");Qe.apply(this,arguments),this.CLASSNAME="StreetAddress",this.attributesList=["bbox","ID","IDTR","quality","territory","commune","department","insee","municipality"],this.serviceAttributes=["bbox","ID","IDTR","Qualite","Territoire","Commune","Departement","INSEE","Municipality"]}$e.prototype=Object.create(Qe.prototype),$e.prototype.constructor=$e;var Ze=$e;function et(){if(!(this instanceof et))throw new TypeError("PositionOfInterest constructor cannot be called as a function.");Qe.apply(this,arguments),this.CLASSNAME="PositionOfInterest",this.attributesList=["bbox","importance","nature","territory","commune","department","insee","municipality"],this.serviceAttributes=["bbox","Importance","Nature","Territoire","Commune","Departement","INSEE","Municipality"]}et.prototype=Object.create(Qe.prototype),et.prototype.constructor=et;var tt=et;function ot(){if(!(this instanceof ot))throw new TypeError("CadastralParcel constructor cannot be called as a function.");Qe.apply(this,arguments),this.CLASSNAME="CadastralParcel",this.attributesList=["absorbedCity","sheet","number","section","commune","department","insee","municipality","origin"],this.serviceAttributes=["CommuneAbsorbee","Feuille","Numero","Section","Commune","Departement","INSEE","Municipality","Type"]}ot.prototype=Object.create(Qe.prototype),ot.prototype.constructor=ot;var rt=ot;function nt(){if(!(this instanceof nt))throw new TypeError("Administratif constructor cannot be called as a function.");Qe.apply(this,arguments),this.CLASSNAME="Administratif",this.attributesList=["bbox","prefecture","inseeRegion","inseeDepartment","municipality"],this.serviceAttributes=["bbox","Prefecture","InseeRegion","InseeDepartement","Municipality"]}nt.prototype=Object.create(Qe.prototype),nt.prototype.constructor=nt;var st=nt,it={build:function(e){var t=n.getLogger("DirectGeocodeRequestFactory");t.trace(["DirectGeocodeRequestFactory::build()"]);var o=null,r=new qe;r.addFilterExtensions(new st),r.addFilterExtensions(new Ze),r.addFilterExtensions(new tt),r.addFilterExtensions(new rt);var s=new We({location:e.location,returnFreeForm:e.returnFreeForm,filterOptions:e.filterOptions});s.addFilter(r);var i=new De({srsName:e.srs,maximumResponses:e.maximumResponses});(i.namespace=!0,i.setService(s),o=i.build(),"GET"===e.httpMethod)&&(o="qxml="+encodeURIComponent(o).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29"));return t.trace(o),o}};function at(){if(!(this instanceof at))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}at.prototype={constructor:at};var lt=at;function ct(){if(!(this instanceof ct))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position={x:null,y:null},this.matchType=null,this.placeAttributes={},this.type=null}ct.prototype={constructor:ct};var ut=ct;function pt(){if(!(this instanceof pt))throw new TypeError("DirectGeocodedLocation constructor cannot be called as a function.");ut.apply(this,arguments),this.CLASSNAME="DirectGeocodedLocation",this.accuracy=null}pt.prototype=Object.create(ut.prototype),pt.prototype.constructor=pt;var ht=pt,ft={};function gt(e,t){if(e.hasChildNodes())for(var o,r,n,s=e.childNodes,i=0;i<s.length;i++){if(1===(o=s[i]).nodeType)if(r=o.localName||o.baseName||o.nodeName,n=o.prefix||ft.DEFAULTPREFIX,ft.READERS[n][r])(0,ft.READERS[n][r])(o,t);else gt(o,t)}}function dt(e){var t,o="";return e.hasChildNodes()&&3===(t=e.firstChild).nodeType&&(o=t.nodeValue),o}ft.VERSION="1.2",ft.NAMESPACES={xmlns:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls",xlsext:"http://www.opengis.net/xlsext",xsi:"http://www.w3.org/2001/XMLSchema-instance"},ft.SCHEMALOCATION="http://wxs.ign.fr/schemas/olsAll.xsd",ft.DEFAULTPREFIX="xls",ft.READERS={xls:{XLS:function(e){var t=new lt;return function(e){if(e.attributes.length>0){var t=function(e){if(e.attributes.length>0){for(var t={},o=e.attributes,r=0;r<o.length;r++){var n=o[r];t[n.nodeName]=n.nodeValue}return t}}(e);for(var o in t)if(t.hasOwnProperty(o)){if("version"===o&&t.version!==ft.VERSION)return void console.log("[DirectGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing");if("xmlns"===o){if(t[o]!==ft.NAMESPACES[ft.DEFAULTPREFIX])return void console.log("[DirectGeocodeResponseReader] geocode response default namespace is not the expected one");continue}var r=o.split(":")[0],n=o.split(":")[1];if("xmlns"===r&&n&&ft.NAMESPACES[n]&&ft.NAMESPACES[n]!==t[o])return void console.log("[DirectGeocodeResponseReader] geocode response "+o+" namespace is not the expected one");if("schemaLocation"===n&&ft.SCHEMALOCATION!==t[o])return void console.log("[DirectGeocodeResponseReader] geocode response schema location is not the expected one")}}}(e),gt(e,t),t},GeocodedAddress:function(e,t){var o=new ht;gt(e,o),t&&Array.isArray(t.locations)&&t.locations.push(o)},GeocodeMatchCode:function(e,t){var o=e.getAttribute("accuracy");o&&t&&(t.accuracy=parseFloat(o));var r=e.getAttribute("matchType");r&&t&&(t.matchType=r)},Address:function(e,t){var o=e.getAttribute("countryCode");t&&o&&(t.type=o),gt(e,t)},freeFormAddress:function(e,t){t&&t.hasOwnProperty("placeAttributes")&&(t.placeAttributes.freeform=dt(e))},Building:function(e,t){var o=e.getAttribute("number");t&&t.hasOwnProperty("placeAttributes")&&(o?t.placeAttributes.number=o:e.getAttribute("buildingName")?t.placeAttributes.number=e.getAttribute("buildingName"):e.getAttribute("subdivision")&&(t.placeAttributes.number=e.getAttribute("subdivision")))},Street:function(e,t){t&&t.hasOwnProperty("placeAttributes")&&("StreetAddress"===t.type?t.placeAttributes.street=dt(e):"CadastralParcel"===t.type&&(t.placeAttributes.cadastralParcel=dt(e)))},Place:function(e,t){var o=e.getAttribute("type"),r=dt(e);if(t&&t.hasOwnProperty("placeAttributes"))if("Municipality"===o)t.placeAttributes.municipality=r;else if("Bbox"===o){var n=r.split(";");4===n.length&&(t.placeAttributes.bbox={left:parseFloat(n[0]),right:parseFloat(n[2]),top:parseFloat(n[1]),bottom:parseFloat(n[3])})}else"Commune"===o?t.placeAttributes.commune=r:"Departement"===o?t.placeAttributes.department=r:"INSEE"===o?t.placeAttributes.insee=r:"Qualite"===o?t.placeAttributes.quality=r:"Territoire"===o?t.placeAttributes.territory=r:"ID"===o?t.placeAttributes.ID=r:"ID_TR"===o?t.placeAttributes.IDTR=r:"Importance"===o?t.placeAttributes.importance=parseInt(r,10):"Nature"===o?t.placeAttributes.nature=r:"Numero"===o?t.placeAttributes.number=r:"Feuille"===o?t.placeAttributes.sheet=r:"Section"===o?t.placeAttributes.section=r:"CommuneAbsorbee"===o?t.placeAttributes.absorbedCity=r:"Arrondissement"===o?r&&(t.placeAttributes.arrondissement=r):"Type"===o?t.placeAttributes.origin=r:"Prefecture"===o?t.placeAttributes.prefecture=r:"InseeRegion"===o?t.placeAttributes.inseeRegion=r:"InseeDepartment"===o&&(t.placeAttributes.inseeDepartment=r)},PostalCode:function(e,t){t&&t.hasOwnProperty("placeAttributes")&&(t.placeAttributes.postalCode=dt(e))},Error:function(e){var t=e.getAttribute("message"),o=e.getAttribute("errorCode"),r=s.getMessage("SERVICE_RESPONSE_EXCEPTION","("+o+") : "+t);throw new a({message:r,type:a.TYPE_SRVERR})}},gml:{pos:function(e,t){var o=dt(e);t&&o&&(t.position={x:parseFloat(o.split(" ")[0]),y:parseFloat(o.split(" ")[1])})}},ExceptionReport:function(e){var t={};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)"Exception"===(o=r[n]).nodeName&&(t.exceptionReport=ft.READERS.Exception(o));return t},Exception:function(e){var t={},o=e.getAttribute("exceptionCode");o&&(t.exceptionCode=o);var r=e.firstChild;return r&&3===r.nodeType&&(t.exception=r.nodeValue),t}},ft.read=function(e){if("XLS"===e.nodeName){var t=e.prefix;return t||(t=ft.DEFAULTPREFIX),ft.READERS[t][e.nodeName](e)}if("ExceptionReport"===e.nodeName)return ft.READERS[e.nodeName](e);var o=s.getMessage("SERVICE_RESPONSE_ANALYSE",e.nodeName);throw new a({message:o,type:a.TYPE_UNKERR,status:200})};var mt=ft,yt={build:function(e){var t=null;if(e.response){if(e.rawResponse)t=e.response;else{try{var o=new D({reader:mt});if("string"==typeof e.response?o.setXMLString(e.response):o.setXMLDoc(e.response),!(t=o.parse()))throw new Error("L'analyse de la réponse du service !?")}catch(t){var r=t.message;return"string"==typeof e.response?r+="('"+e.response+"')":r+="('"+e.response.documentElement.innerHTML+"')",void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_ANALYSE",r),type:a.TYPE_UNKERR,status:-1}))}if(t.exceptionReport)return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EXCEPTION",t.exceptionReport),type:a.TYPE_SRVERR,status:200}))}e.onSuccess.call(e.scope,t)}else e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EMPTY"),type:a.TYPE_SRVERR,status:-1}))}};function Et(e){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vt(e){if(!(this instanceof vt))throw new TypeError(s.getMessage("CLASS_CONSTRUCTOR","Geocode"));if(this.CLASSNAME="Geocode",_.apply(this,arguments),this.logger=n.getLogger("Gp.Services.Geocode"),this.logger.trace("[Constructeur Geocode (options)]"),!e.location)throw new Error(s.getMessage("PARAM_MISSING","location"));if("object"===Et(e.location)&&0===Object.keys(e.location).length)throw new Error(s.getMessage("PARAM_EMPTY","location"));if("string"==typeof e.location&&0===e.location.length)throw new Error(s.getMessage("PARAM_EMPTY","location"));this.options.location=e.location,e.filterOptions&&"object"===Et(e.filterOptions)||(this.options.filterOptions=e.filterOptions={type:["StreetAddress"]}),0===Object.keys(e.filterOptions).length&&(this.options.filterOptions={type:["StreetAddress"]});for(var t=Object.keys(e.filterOptions),o=0;o<t.length;o++){var r=t[o],i=["department","number","postalCode","insee","importance","ID","IDTR","absorbedCity","sheet","section","inseeRegion","inseeDepartment"];-1!==i.indexOf(r)&&"string"!=typeof e.filterOptions[r]&&(e.filterOptions[r]=e.filterOptions[r].toString()),e.filterOptions[r]||delete this.options.filterOptions[r]}this.options.filterOptions.type=e.filterOptions.type||["StreetAddress"],this.options.maximumResponses=e.maximumResponses||25,this.options.returnFreeForm=e.returnFreeForm||!1,this.options.srs=e.srs||"EPSG:4326",this.options.outputFormat=this.options.rawResponse?"":"xml"}vt.prototype=Object.create(_.prototype,{}),vt.prototype.constructor=vt,vt.prototype.buildRequest=function(e,t){var o={httpMethod:this.options.httpMethod,location:this.options.location,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions,srs:this.options.srs,maximumResponses:this.options.maximumResponses};this.request=it.build(o),this.request?t.call(this,this.request):e.call(this,new a(s.getMessage("SERVICE_REQUEST_BUILD")))},vt.prototype.analyzeResponse=function(e,t){if(this.response){var o={response:this.response,rawResponse:this.options.rawResponse,onError:e,onSuccess:t,scope:this};yt.build(o)}else e.call(this,new a(s.getMessage("SERVICE_RESPONSE_EMPTY")))};var _t=vt,wt={build:function(e){var t=n.getLogger("ReverseGeocodeRequestFactory");t.trace(["ReverseGeocodeRequestFactory::build()"]);var o=e||{},r=null,s=new We({position:o.position,returnFreeForm:o.returnFreeForm,filterOptions:o.filterOptions}),i=new De({srsName:o.srs,maximumResponses:o.maximumResponses});(i.namespace=!0,i.setService(s),r=i.build(),"GET"===o.httpMethod)&&(r="qxml="+encodeURIComponent(r).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29"));return t.trace(r),r}};function St(){if(!(this instanceof St))throw new TypeError("ReverseGeocodedLocation constructor cannot be called as a function.");ut.apply(this,arguments),this.CLASSNAME="ReverseGeocodedLocation",this.searchCenterDistance=null}St.prototype=Object.create(ut.prototype),St.prototype.constructor=St;var Rt=St,bt={};function At(e,t){if(e.hasChildNodes())for(var o,r,n,s=e.childNodes,i=0;i<s.length;i++){if(1===(o=s[i]).nodeType)if(r=o.localName||o.baseName||o.nodeName,n=o.prefix||bt.DEFAULTPREFIX,bt.READERS[n][r])(0,bt.READERS[n][r])(o,t);else At(o,t)}}function Tt(e){var t,o="";return e.hasChildNodes()&&3===(t=e.firstChild).nodeType&&(o=t.nodeValue),o}bt.VERSION="1.2",bt.NAMESPACES={xmlns:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls",xlsext:"http://www.opengis.net/xlsext",xsi:"http://www.w3.org/2001/XMLSchema-instance"},bt.SCHEMALOCATION="http://wxs.ign.fr/schemas/olsAll.xsd",bt.DEFAULTPREFIX="xls",bt.READERS={xls:{XLS:function(e){var t=new lt;return function(e){if(e.attributes.length>0){var t=function(e){if(e.attributes.length>0){for(var t={},o=e.attributes,r=0;r<o.length;r++){var n=o[r];t[n.nodeName]=n.nodeValue}return t}}(e);for(var o in t)if(t.hasOwnProperty(o)){if("version"===o&&t.version!==bt.VERSION)return void console.log("[ReverseGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing");if("xmlns"===o){if(t[o]!==bt.NAMESPACES[bt.DEFAULTPREFIX])return void console.log("[ReverseGeocodeResponseReader] geocode response default namespace is not the expected one");continue}var r=o.split(":")[0],n=o.split(":")[1];if("xmlns"===r&&n&&bt.NAMESPACES[n]&&bt.NAMESPACES[n]!==t[o])return void console.log("[ReverseGeocodeResponseReader] geocode response "+o+" namespace is not the expected one");if("schemaLocation"===n&&bt.SCHEMALOCATION!==t[o])return void console.log("[ReverseGeocodeResponseReader] geocode response schema location is not the expected one")}}}(e),At(e,t),t},ReverseGeocodedLocation:function(e,t){var o=new Rt;At(e,o),t&&Array.isArray(t.locations)&&t.locations.push(o)},Address:function(e,t){var o=e.getAttribute("countryCode");t&&o&&(t.type=o),At(e,t)},Building:function(e,t){var o=e.getAttribute("number");t&&t.hasOwnProperty("placeAttributes")&&(o?t.placeAttributes.number=o:e.getAttribute("buildingName")?t.placeAttributes.number=e.getAttribute("buildingName"):e.getAttribute("subdivision")&&(t.placeAttributes.number=e.getAttribute("subdivision")))},Street:function(e,t){"StreetAddress"===t.type?t.placeAttributes.street=Tt(e):"CadastralParcel"===t.type&&(t.placeAttributes.cadastralParcel=Tt(e))},Place:function(e,t){var o=e.getAttribute("type"),r=Tt(e);if(t&&t.hasOwnProperty("placeAttributes"))if("Municipality"===o)t.placeAttributes.municipality=r;else if("Bbox"===o){var n=r.split(";");4===n.length&&(t.placeAttributes.bbox={left:parseFloat(n[0]),right:parseFloat(n[2]),top:parseFloat(n[1]),bottom:parseFloat(n[3])})}else"Commune"===o?t.placeAttributes.commune=r:"Departement"===o?t.placeAttributes.department=r:"INSEE"===o?t.placeAttributes.insee=r:"Qualite"===o?t.placeAttributes.quality=r:"Territoire"===o?t.placeAttributes.territory=r:"ID"===o?t.placeAttributes.ID=r:"ID_TR"===o?t.placeAttributes.IDTR=r:"Importance"===o?t.placeAttributes.importance=parseInt(r,10):"Nature"===o?t.placeAttributes.nature=r:"Numero"===o?t.placeAttributes.number=r:"Feuille"===o?t.placeAttributes.sheet=r:"Section"===o?t.placeAttributes.section=r:"CommuneAbsorbee"===o?t.placeAttributes.absorbedCity=r:"Arrondissement"===o?r&&(t.placeAttributes.arrondissement=r):"Type"===o?t.placeAttributes.origin=r:"Prefecture"===o?t.placeAttributes.prefecture=r:"InseeRegion"===o?t.placeAttributes.inseeRegion=r:"InseeDepartment"===o&&(t.placeAttributes.inseeDepartment=r)},PostalCode:function(e,t){t&&t.hasOwnProperty("placeAttributes")&&(t.placeAttributes.postalCode=Tt(e))},SearchCentreDistance:function(e,t){t&&(t.searchCenterDistance=parseFloat(e.getAttribute("value")))},Error:function(e){var t=e.getAttribute("message"),o=e.getAttribute("errorCode"),r=s.getMessage("SERVICE_RESPONSE_EXCEPTION","("+o+") : "+t);throw new a({message:r,type:a.TYPE_SRVERR})}},gml:{pos:function(e,t){var o=Tt(e);t&&o&&(t.position={x:parseFloat(o.split(" ")[0]),y:parseFloat(o.split(" ")[1])})}},xlsext:{ExtendedGeocodeMatchCode:function(e,t){t&&(t.matchType=Tt(e))}},ExceptionReport:function(e){var t={};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)"Exception"===(o=r[n]).nodeName&&(t.exceptionReport=bt.READERS.Exception(o));return t},Exception:function(e){var t={},o=e.getAttribute("exceptionCode");o&&(t.exceptionCode=o);var r=e.firstChild;return r&&3===r.nodeType&&(t.exception=r.nodeValue),t}},bt.read=function(e){if("XLS"===e.nodeName){var t=e.prefix;return t||(t=bt.DEFAULTPREFIX),bt.READERS[t][e.nodeName](e)}if("ExceptionReport"===e.nodeName)return bt.READERS[e.nodeName](e);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")};var Ot=bt,Pt={build:function(e){var t=null;if(e.response){if(e.rawResponse)t=e.response;else{try{var o=new D({reader:Ot});if("string"==typeof e.response?o.setXMLString(e.response):o.setXMLDoc(e.response),!(t=o.parse()))throw new Error("L'analyse de la réponse du service !?")}catch(t){return t.status=200,void e.onError.call(e.scope,t)}if(t.exceptionReport)return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EXCEPTION",t.exceptionReport),type:a.TYPE_SRVERR,status:200}));var r,n;if(e.scope&&e.scope.options&&e.scope.options.srs&&"EPSG:4326"!==e.scope.options.srs)if(t.locations)for(var i=0;i<t.locations.length;i++)(r=t.locations[i])&&(n=r.position)&&(r.position={x:n.y,y:n.x})}e.onSuccess.call(e.scope,t)}else e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EMPTY"),type:a.TYPE_SRVERR,status:-1}))}};function xt(e){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ct(e){if(!(this instanceof Ct))throw new TypeError(s.getMessage("CLASS_CONSTRUCTOR","ReverseGeocode"));if(this.CLASSNAME="ReverseGeocode",_.apply(this,arguments),this.logger=n.getLogger("Gp.Services.ReverseGeocode"),this.logger.trace("[Constructeur ReverseGeocode (options)]"),!e.position)throw new Error(s.getMessage("PARAM_MISSING","position"));if(null===e.position.x)throw new Error(s.getMessage("PARAM_MISSING","position.x"));if(null===e.position.y)throw new Error(s.getMessage("PARAM_MISSING","position.y"));this.options.position=e.position,e.filterOptions&&"object"===xt(e.filterOptions)||(this.options.filterOptions=e.filterOptions={type:["StreetAddress"]}),0===Object.keys(e.filterOptions).length&&(this.options.filterOptions={type:["StreetAddress"]});for(var t=Object.keys(e.filterOptions),o=0;o<t.length;o++){var r=t[o];e.filterOptions[r]&&0!==Object.keys(e.filterOptions[r]).length||delete this.options.filterOptions[r]}if(this.options.filterOptions.type=e.filterOptions.type||["StreetAddress"],!Array.isArray(this.options.filterOptions.type))throw new Error(s.getMessage("PARAM_TYPE","filterOptions.type"));if(this.options.maximumResponses=e.maximumResponses||25,this.options.returnFreeForm=e.returnFreeForm||!1,this.options.srs=e.srs||"CRS:84",-1===Ct.geoEPSG.indexOf(this.options.srs)){if(this.options.position={x:this.options.position.y,y:this.options.position.x},this.options.filterOptions&&this.options.filterOptions.circle){var i=this.options.filterOptions.circle;this.options.filterOptions.circle={x:i.y,y:i.x,radius:i.radius}}if(this.options.filterOptions&&this.options.filterOptions.polygon){var a=this.options.filterOptions.polygon;for(o=0;o<a.length;o++){var l=a[o];this.options.filterOptions.polygon[o]={x:l.y,y:l.x}}}}this.options.outputFormat=this.options.rawResponse?"":"xml"}Ct.prototype=Object.create(_.prototype,{}),Ct.prototype.constructor=Ct,Ct.prototype.buildRequest=function(e,t){var o={httpMethod:this.options.httpMethod,position:this.options.position,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions,srs:"EPSG:4326",maximumResponses:this.options.maximumResponses};this.request=wt.build(o),this.request?t.call(this,this.request):e.call(this,new a(s.getMessage("SERVICE_REQUEST_BUILD")))},Ct.prototype.analyzeResponse=function(e,t){if(this.response){var o={response:this.response,rawResponse:this.options.rawResponse,onError:e,onSuccess:t,scope:this};Pt.build(o)}else e.call(this,new a(s.getMessage("SERVICE_RESPONSE_EMPTY")))},Ct.geoEPSG=["EPSG:4326"];var Nt=Ct;function It(){if(!(this instanceof It))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}It.prototype={constructor:It};var Mt=It;function Lt(){if(!(this instanceof Lt))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}Lt.prototype={constructor:Lt};var Dt=Lt,Ft={build:function(e){var t=n.getLogger("AutoCompleteResponseFactory");t.trace(["AutoCompleteResponseFactory::build()"]);var o=null;if(e.response){if(e.rawResponse)t.trace("analyze response : raw"),o=e.response;else{var r=null;if(r="string"==typeof e.response?JSON.parse(e.response):e.response){if(r.error)return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EXCEPTION",r.error.description),status:r.error.code,type:a.TYPE_SRVERR}));if(o=new Mt,!r.results||!Array.isArray(r.results))return void e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_FORMAT_3")));for(var i=null,l=0;l<r.results.length;l++){var c=r.results[l];i=new Dt,c&&("StreetAddress"===c.country?(i.street=c.street,i.type="StreetAddress"):"PositionOfInterest"===c.country&&(i.poi=c.street,i.kind=c.kind,i.type="PositionOfInterest"),i.position&&(i.position.x=c.x,i.position.y=c.y),i.commune=c.city,i.fullText=c.fulltext,i.postalCode=c.zipcode,i.classification=c.classification),o.suggestedLocations.push(i)}if(!o.suggestedLocations.length)return void e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_FORMAT_3")))}if(!o)return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:a.TYPE_UNKERR,status:-1}));if(o.exceptionReport)return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EXCEPTION",o.exceptionReport),type:a.TYPE_SRVERR,status:200}))}e.onSuccess.call(e.scope,o)}else e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_EMPTY")))}};function kt(e){return(kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ut(e){if(!(this instanceof Ut))throw new TypeError(s.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));if(this.CLASSNAME="AutoComplete",_.apply(this,arguments),this.logger=n.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete (options)]"),!e.text)throw new Error(s.getMessage("PARAM_MISSING","text"));this.options.text=e.text,e.filterOptions&&"object"===kt(e.filterOptions)||(this.options.filterOptions=e.filterOptions={territory:[],type:["StreetAddress"]}),0===Object.keys(e.filterOptions).length&&(this.options.filterOptions={territory:[],type:["StreetAddress"]}),this.options.filterOptions.type=e.filterOptions.type||["StreetAddress"],this.options.filterOptions.territory=e.filterOptions.territory||[],this.options.maximumResponses=e.maximumResponses||10,"XHR"===this.options.protocol&&"POST"===this.options.httpMethod&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"json"}Ut.prototype=Object.create(_.prototype,{}),Ut.prototype.constructor=Ut,Ut.prototype.buildRequest=function(e,t){var o="";this.options.filterOptions.territory&&(o=this.options.filterOptions.territory.join(";"));var r="";this.options.filterOptions.type&&(r=this.options.filterOptions.type.join(",")),this.request=l.normalyzeParameters({text:encodeURIComponent(this.options.text),type:r,terr:o,maximumResponses:this.options.maximumResponses}),this.request?t.call(this,this.request):e.call(this,new a(s.getMessage("SERVICE_REQUEST_BUILD")))},Ut.prototype.analyzeResponse=function(e,t){if(this.response){var o={response:this.response,rawResponse:this.options.rawResponse,onSuccess:t,onError:e,scope:this};Ft.build(o)}else e.call(this,new a(s.getMessage("SERVICE_RESPONSE_EMPTY")))};var qt=Ut;function Gt(e){if(!(this instanceof Gt))throw new TypeError("RouteParamREST constructor cannot be called as a function.");this.logger=n.getLogger(),this.logger.trace("[Constructeur RouteParamREST ()]"),this.options=e||{},this.resource=this.options.resource,this.start=this.options.startPoint.x+","+this.options.startPoint.y,this.end=this.options.endPoint.x+","+this.options.endPoint.y,this.intermediates=this.options.viaPoints,this.profile=this.options.graph,this.crs=this.options.srs,this.constraints=this.options.constraints,this.optimization=this.options.routePreference,this.getSteps=this.options.geometryInInstructions?"true":"false",this.distanceUnit=this.options.distanceUnit,this.timeUnit=this.options.timeUnit,this.waysAttributes=this.options.waysAttributes}Gt.CLASSNAME="RouteParamREST",Gt.prototype={constructor:Gt,getIntermediates:function(){var e=[];if(0!==this.intermediates.length)for(var t=0;t<this.intermediates.length;t++){var o=this.intermediates[t];e.push(o.x+","+o.y)}return e.join("|")},getWaysAttributes:function(){return this.waysAttributes.join("|")},getProfile:function(){return this.profile},getDistanceUnit:function(){return"m"===this.distanceUnit?"meter":"km"===this.distanceUnit?"kilometer":""},getOptimization:function(){return this.optimization?this.optimization:""},getConstraints:function(){var e=[];if(0!==this.constraints.length)for(var t=0;t<this.constraints.length;t++)e.push(JSON.stringify(this.constraints[t]));return e.join("|")}},Gt.prototype.getParams=function(){var e=[];return e.push({k:"resource",v:this.resource}),e.push({k:"start",v:this.start}),e.push({k:"end",v:this.end}),e.push({k:"geometryFormat",v:"geojson"}),this.optimization&&e.push({k:"optimization",v:this.getOptimization()}),this.intermediates&&e.push({k:"intermediates",v:this.getIntermediates()}),this.profile&&e.push({k:"profile",v:this.getProfile()}),this.constraints&&e.push({k:"constraints",v:this.getConstraints()}),this.crs&&e.push({k:"crs",v:this.crs}),this.distanceUnit&&e.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.timeUnit&&e.push({k:"timeUnit",v:this.timeUnit}),this.waysAttributes&&e.push({k:"waysAttributes",v:this.getWaysAttributes()}),e};var jt=Gt;function Vt(e){if(this.logger=n.getLogger("RouteRequestREST"),this.logger.trace("[Constructeur RouteRequestREST ()]"),!(this instanceof Vt))throw new TypeError("RouteRequestREST constructor cannot be called as a function.");if(!e)throw new Error(s.getMessage("PARAM_EMPTY","options"));this.settings=e}Vt.prototype={requestString:null,constructor:Vt,processRequestString:function(){this.logger.warn(" PROTOTYPE !");for(var e=new jt(this.settings).getParams(),t="",o=0;o<e.length;o++){var r=e[o];t&&(t+="&"),t+=r.k+"="+r.v}return this.logger.trace(t),this.requestString=t,this.requestString}};var Xt=Vt,Yt={build:function(e){n.getLogger("RouteRequestFactory").trace(["RouteRequestFactory::build()"]);var t=e||{},o=!(null===e.onError||"function"!=typeof e.onError),r=null,s=new Xt(t);if(!s.processRequestString()){if(r="Error process request (rest) !",o)return void e.onError.call(e.scope,new a(r));throw new Error(r)}return s.requestString}};function Ht(){if(!(this instanceof Ht))throw new TypeError("RouteResponse constructor cannot be called as a function.");this.totalTime=null,this.totalDistance=null,this.bbox={left:null,right:null,top:null,bottom:null},this.routeGeometry=null,this.routeInstructions=[]}Ht.prototype={constructor:Ht};var zt=Ht;function Kt(){if(!(this instanceof Kt))throw new TypeError("RouteInstruction constructor cannot be called as a function.");this.duration=null,this.distance=null,this.code=null,this.instruction=null,this.geometry=null}Kt.prototype={constructor:Kt};var Bt=Kt,Wt={build:function(e){var t=n.getLogger("RouteResponseFactory");t.trace("RouteResponseFactory::build()");var o=null;if(e.response){if(e.rawResponse)t.trace("analyze response : raw"),o=e.response;else{var r;if(t.trace("analyze response : json"),r="string"==typeof e.response?JSON.parse(e.response):e.response){if(r.message)return void e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_EXCEPTION",r.message)));var i=[],l=[],c=[];if((o=new zt).hasOwnProperty("totalTime")&&(o.totalTime=parseFloat(r.duration)),o.hasOwnProperty("totalDistance")&&(o.totalDistance=parseFloat(r.distance)),o.hasOwnProperty("bbox")&&(o.bbox.left=parseFloat(r.bbox[0]),o.bbox.bottom=parseFloat(r.bbox[1]),o.bbox.right=parseFloat(r.bbox[2]),o.bbox.top=parseFloat(r.bbox[3])),o.hasOwnProperty("routeGeometry")&&!e.geometryInInstructions&&(o.routeGeometry=r.geometry),o.hasOwnProperty("routeInstructions")&&e.geometryInInstructions){var u,p=r.portions;if(Array.isArray(p)&&p.length)for(u=0;u<p.length;u++)i.push(p[u]);if(i.length)for(u=0;u<i.length;u++)l.push(i[u].steps);if(l.length)for(u=0;u<l.length;u++)c=c.concat(l[u]);c.forEach((function(e){switch(o.routeInstructions.push(new Bt),o.routeInstructions[o.routeInstructions.length-1].duration=e.duration,o.routeInstructions[o.routeInstructions.length-1].distance=e.distance,o.routeInstructions[o.routeInstructions.length-1].code="",o.routeInstructions[o.routeInstructions.length-1].instruction="",o.routeInstructions[o.routeInstructions.length-1].geometry=e.geometry,"Valeur non renseignée"===e.name&&(e.name=""),e.instruction.type){case"turn":o.routeInstructions[o.routeInstructions.length-1].instruction+="Tourner";break;case"new name":o.routeInstructions[o.routeInstructions.length-1].instruction+="Continuer tout droit";break;case"depart":o.routeInstructions[o.routeInstructions.length-1].instruction+="Départ";break;case"arrive":o.routeInstructions[o.routeInstructions.length-1].instruction+="Arrivée";break;case"merge":o.routeInstructions[o.routeInstructions.length-1].instruction+="Rejoindre";break;case"ramp":case"on ramp":o.routeInstructions[o.routeInstructions.length-1].instruction+="Prendre la bretelle";break;case"off ramp":o.routeInstructions[o.routeInstructions.length-1].instruction+="Prendre la sortie";break;case"fork":o.routeInstructions[o.routeInstructions.length-1].instruction+="Sur la bifurcation, prendre";break;case"end of road":o.routeInstructions[o.routeInstructions.length-1].instruction+="À la fin de la route, prendre";break;case"use lane":o.routeInstructions[o.routeInstructions.length-1].instruction+="Utiliser la file";break;case"continue":o.routeInstructions[o.routeInstructions.length-1].instruction+="Continuer";break;case"roundabout":case"rotary":o.routeInstructions[o.routeInstructions.length-1].instruction+="Au rond-point";break;case"roundabout turn":o.routeInstructions[o.routeInstructions.length-1].instruction+="Au rond point, tourner";break;case"notification":o.routeInstructions[o.routeInstructions.length-1].instruction+="";break;default:o.routeInstructions[o.routeInstructions.length-1].instruction+="?"+e.instruction.type+"?"}if(e.instruction.modifier)switch(e.instruction.modifier){case"uturn":o.routeInstructions[o.routeInstructions.length-1].instruction="Faire demi-tour";break;case"sharp right":o.routeInstructions[o.routeInstructions.length-1].instruction+=" complètement à droite";break;case"right":o.routeInstructions[o.routeInstructions.length-1].instruction+=" à droite";break;case"slight right":o.routeInstructions[o.routeInstructions.length-1].instruction+=" légèrement à droite";break;case"straight":o.routeInstructions[o.routeInstructions.length-1].instruction="Continuer tout droit";break;case"slight left":o.routeInstructions[o.routeInstructions.length-1].instruction+=" lègèrement à gauche";break;case"left":o.routeInstructions[o.routeInstructions.length-1].instruction+=" à gauche";break;case"sharp left":o.routeInstructions[o.routeInstructions.length-1].instruction+=" complètement à gauche";break;default:o.routeInstructions[o.routeInstructions.length-1].instruction+=" ?"+e.instruction.modifier+"?"}e.instruction.exit&&(o.routeInstructions[o.routeInstructions.length-1].instruction+="".concat(e.instruction.exit,"e sortie")),e.attributes.name&&((e.attributes.name.nom_1_droite||e.attributes.name.toponyme)&&(o.routeInstructions[o.routeInstructions.length-1].instruction+=" sur"),e.attributes.name.nom_1_droite&&(o.routeInstructions[o.routeInstructions.length-1].instruction+=" ".concat(e.attributes.name.nom_1_droite)),e.attributes.name.toponyme&&(o.routeInstructions[o.routeInstructions.length-1].instruction+=" ".concat(e.attributes.name.toponyme)))}))}}if(!o)return void e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_ANALYSE","json")));if(o.exceptionReport)return void e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_EXCEPTION_2")))}e.onSuccess.call(e.scope,o)}else e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_EMPTY")))}};function Jt(e){if(!(this instanceof Jt))throw new TypeError(s.getMessage("CLASS_CONSTRUCTOR","Route"));if(this.CLASSNAME="Route",_.apply(this,arguments),this.logger=n.getLogger("Gp.Services.Route"),this.logger.trace("[Constructeur Route (options)]"),!e.startPoint)throw new Error(s.getMessage("PARAM_MISSING","startPoint"));if(null===e.startPoint.x)throw new Error(s.getMessage("PARAM_MISSING","startPoint.x"));if(null===e.startPoint.y)throw new Error(s.getMessage("PARAM_MISSING","startPoint.y"));if(!e.endPoint)throw new Error(s.getMessage("PARAM_MISSING","endPoint"));if(null===e.endPoint.x)throw new Error(s.getMessage("PARAM_MISSING","endPoint.x"));if(null===e.endPoint.y)throw new Error(s.getMessage("PARAM_MISSING","endPoint.y"));if(e.outputFormat&&"json"!==e.outputFormat&&this.logger.warn("options.outputFormat could only be json"),this.options.outputFormat="json",this.options.resource=e.resource||"bdtopo-osrm",this.options.startPoint=e.startPoint,this.options.endPoint=e.endPoint,this.options.viaPoints=e.viaPoints||[],this.options.routePreference=e.routePreference||"fastest",e.graph?("Voiture"===e.graph&&(this.options.graph="car"),"Pieton"===e.graph&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],e.constraints){if(!Array.isArray(e.constraints))throw new Error(s.getMessage("PARAM_TYPE","constraints"));for(var t=0;t<e.constraints.length;t++)this.options.constraints.push(e.constraints[t])}var o={},r={},i={};if(e.exclusions&&0!==e.exclusions.length){this.logger.warn("options.exclusions is DEPRECATED !!");for(var a=0;a<e.exclusions.length;a++)"string"==typeof e.exclusions[a]&&(e.exclusions[a]=e.exclusions[a].toLowerCase(),"toll"===e.exclusions[a]&&(i.constraintType="banned",i.key="wayType",i.operator="=",i.value="autoroute",this.options.constraints.push(i)),"tunnel"===e.exclusions[a]&&(o.constraintType="banned",o.key="wayType",o.operator="=",o.value="tunnel",this.options.constraints.push(o)),"bridge"===e.exclusions[a]&&(r.constraintType="banned",r.key="wayType",r.operator="=",r.value="pont",this.options.constraints.push(r)))}if(this.options.geometryInInstructions=e.geometryInInstructions||!1,this.options.provideBbox=e.provideBbox||!0,this.options.distanceUnit=e.distanceUnit||"m",this.options.timeUnit=e.timeUnit||"second",this.options.expectedStartTime=null,this.options.srs=e.srs||"EPSG:4326",this.options.waysAttributes=e.waysAttributes||[],!this.options.serverUrl){var l=y.Route.url(this.options.apiKey);if(!l)throw new Error("Url by default not found !");this.options.serverUrl=l,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}Jt.prototype=Object.create(_.prototype,{}),Jt.prototype.constructor=Jt,Jt.prototype.buildRequest=function(e,t){var o={resource:this.options.resource,startPoint:this.options.startPoint,endPoint:this.options.endPoint,viaPoints:this.options.viaPoints,provideBbox:this.options.provideBbox,constraints:this.options.constraints,distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,graph:this.options.graph,geometryInInstructions:this.options.geometryInInstructions,routePreference:this.options.routePreference,srs:this.options.srs,waysAttributes:this.options.waysAttributes};this.request=Yt.build(o),this.request?t.call(this,this.request):e.call(this,new a(s.getMessage("SERVICE_REQUEST_BUILD")))},Jt.prototype.analyzeResponse=function(e,t){if(this.response){var o={distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:e,onSuccess:t,scope:this,geometryInInstructions:this.options.geometryInInstructions};Wt.build(o)}else e.call(this,new a(s.getMessage("SERVICE_RESPONSE_EMPTY")))};var Qt=Jt;function $t(e){if(!(this instanceof $t))throw new TypeError("ProcessIsoCurveParam constructor cannot be called as a function.");switch(this.logger=n.getLogger(),this.logger.trace("[Constructeur ProcessIsoCurveParam ()]"),this.options=e||{},this.id=this.options.id,this.location=this.options.position,this.srs=this.options.srs,this.graphName=this.options.graph,this.profileId=this.options.profileId||null,this.profileName=this.options.profileName||null,this.exclusions=this.options.exclusions,this.reverse=this.options.reverse,this.smoothing=this.options.smoothing,this.holes=this.options.holes,this.options.method){case"time":this.method="time",this.time=this.options.time;break;case"distance":this.method="distance",this.distance=this.options.distance;break;default:this.logger.warn("Par defaut, on calcule un isochrone !"),this.method="time"}}$t.CLASSNAME="ProcessIsoCurveParam",$t.prototype={constructor:$t,getLocation:function(){return this.location.x+","+this.location.y},getExclusions:function(){return this.exclusions.join(";")}},$t.prototype.getParams=function(){var e=[];return e.push({k:"location",v:this.getLocation()}),e.push({k:"smoothing",v:this.smoothing}),e.push({k:"holes",v:this.holes}),e.push({k:"reverse",v:this.reverse}),e.push({k:"method",v:this.method}),this.time&&e.push({k:"time",v:this.time}),this.distance&&e.push({k:"distance",v:this.distance}),e.push({k:"graphName",v:this.graphName}),this.exclusions&&e.push({k:"exclusions",v:this.getExclusions()}),this.srs&&e.push({k:"srs",v:this.srs}),e};var Zt=$t;function eo(e){if(this.logger=n.getLogger("ProcessIsoCurveRequest"),this.logger.trace("[Constructeur ProcessIsoCurveRequest ()]"),!(this instanceof eo))throw new TypeError("ProcessIsoCurveRequest constructor cannot be called as a function.");if(!e)throw new Error(s.getMessage("PARAM_EMPTY","options"));this.settings=e,this.mode=this.settings.httpMethod||"GET"}eo.prototype={requestString:null,constructor:eo,template:{container:'<?xml version="1.0" encoding="UTF-8"?>\n<isochroneRequest>\n__ID__\t<location>\n\t\t<x>__X__</x>\n\t\t<y>__Y__</y>\n\t</location>\n\t<srs>__SRS__</srs>\n\t<graphName>__GRAPHNAME__</graphName>\n__PROFIL____EXCLUSIONS__\t<method>__METHOD__</method>\n__TIME____DISTANCE__\t<reverse>__REVERSE__</reverse>\n\t<smoothing>__SMOOTHING__</smoothing>\n\t<holes>__HOLES__</holes>\n</isochroneRequest>',id:"\t<id>__IDVALUE__</id>\n",profil:"\t<profileId>__PROFILID__</profileId>\n\t<profileName>__PROFILNAME__</profileName>\n",exclusions:{container:"\t<exclusions>\n__EXCLUSIONFEATURE__\n\t</exclusions>\n",feature:"\t\t<exclusion>__EXCLUSIONVALUE__</exclusion>"},time:"\t<time>__TIMEVALUE__</time>\n",distance:"\t<distance>__DISTANCEVALUE__</distance>\n"},processRequestString:function(){var e="",t=0;switch(this.mode){case"GET":this.logger.trace("Process GET Request");var o=new Zt(this.settings).getParams();for(t=0;t<o.length;t++){var r=o[t];e&&(e+="&"),e+=r.k+"="+r.v}break;case"POST":if(this.logger.trace("Process POST Request"),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=this.template.container).replace(/__ID__/g,"")).replace(/__PROFIL__/g,"")).replace(/__X__/g,this.settings.position.x)).replace(/__Y__/g,this.settings.position.y)).replace(/__GRAPHNAME__/g,this.settings.graph)).replace(/__SRS__/g,this.settings.srs)).replace(/__SMOOTHING__/g,this.settings.smoothing)).replace(/__HOLES__/g,this.settings.holes)).replace(/__REVERSE__/g,this.settings.reverse),this.settings.exclusions){var n=this.template.exclusions.container,s=[];for(t=0;t<this.settings.exclusions.length;t++){var i=this.template.exclusions.feature;i=i.replace(/__EXCLUSIONVALUE__/,this.settings.exclusions[t]),s.push(i)}n=n.replace(/__EXCLUSIONFEATURE__/,s.join("\n")),e=e.replace(/__EXCLUSIONS__/g,n)}if(e=e.replace(/__EXCLUSIONS__/g,""),this.settings.distance){var a=this.template.distance;a=a.replace(/__DISTANCEVALUE__/g,this.settings.distance),e=(e=e.replace(/__DISTANCE__/g,a)).replace(/__METHOD__/g,"distance")}if(e=e.replace(/__DISTANCE__/g,""),this.settings.time){var l=this.template.time;l=l.replace(/__TIMEVALUE__/g,this.settings.time),e=(e=e.replace(/__TIME__/g,l)).replace(/__METHOD__/g,"time")}e=e.replace(/__TIME__/g,"");break;default:this.logger.error("No other HTTP method supported by the service !")}return this.logger.trace(e),this.requestString=e,this.requestString}};var to=eo,oo={toJson:function(e,t,o){var r=n.getLogger(),s=null;try{if(!e)throw new Error("La chaine WKT n'est pas renseignée !");var i,a;if(t||(t=function(e){console.log(e)}),o||(o=function(e){console.log(e)}),i=/(-?\d+\.?[0-9]*)\s(-?\d+\.?[0-9]+)/g,a="[$1,$2]",e=e.replace(i,a),(i=/^(\w+)/).exec(e),"POLYGON"===RegExp.$1?(a='{"type" : "Polygon",',e=e.replace(RegExp.$1,a),i=/(\({2}?)/,a='"coordinates" : [[',e=e.replace(i,a),i=/(\){2}?)/,a="]]}",e=e.replace(i,a),i=/(\()/g,a="[",e=e.replace(i,a),i=/(\))/g,a="]",e=e.replace(i,a)):"LINESTRING"===RegExp.$1&&(a='{"type" : "LineString",',e=e.replace(RegExp.$1,a),i=/(\(\(?)/,a='"coordinates" : [',e=e.replace(i,a),i=/(\)\)?)/,a="]}",e=e.replace(i,a)),r.trace(e),!(s=JSON.parse(e)))throw new Error("Le JSON est vide !");if(!s.type)throw new Error("Le type de geometrie n'est pas connu !");if(!s.coordinates)throw new Error("La liste des points est vide !");t.call(this,s)}catch(e){if("SyntaxError"===e.name)return void o.call(this,"Erreur de parsing JSON !");o.call(this,e)}}};function ro(){if(!(this instanceof ro))throw new TypeError("ProcessIsoCurveResponse constructor cannot be called as a function.");this.message=null,this.id=null,this.location={},this.location.x=null,this.location.y=null,this.srs=null,this.geometry=null,this.time=null,this.distance=null}ro.prototype={constructor:ro};var no=ro,so={};function io(e){var t,o="";return e.hasChildNodes()&&(t=e.firstChild)&&3===t.nodeType&&(o=t.nodeValue),o}so.READERS={isochronResult:function(e){var t=new no;if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)o=r[n],so.READERS[o.nodeName]&&so.READERS[o.nodeName](o,t);if("error"===t.status){var i=s.getMessage("SERVICE_RESPONSE_EXCEPTION",t.message);throw new a({message:i,type:a.TYPE_SRVERR})}return t},message:function(e,t){t&&(t.message=io(e))},status:function(e,t){var o=io(e);"ERROR"!==o&&"error"!==o||t&&(t.status="error")},id:function(e,t){t&&(t.id=io(e))},location:function(e,t){var o=io(e);t&&t.location&&(t.location.x=parseFloat(o.split(",")[0]),t.location.y=parseFloat(o.split(",")[1]))},srs:function(e,t){t&&(t.srs=io(e))},distance:function(e,t){t&&(t.distance=parseFloat(io(e)))},time:function(e,t){t&&(t.time=parseFloat(io(e)))},wktGeometry:function(e,t){if(t){var o=e.innerHTML;t.hasOwnProperty("geometry")&&oo.toJson(o,(function(e){t.geometry=e}),(function(){var e=s.getMessage("PARAM_FORMAT",["wktGeometry"]);throw new Error(e)}))}},serviceResult:function(e){var t={};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)o=r[n],so.READERS[o.nodeName]&&so.READERS[o.nodeName](o,t);return t},ExceptionReport:function(e){var t={};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)"Exception"===(o=r[n]).nodeName&&(t.exceptionReport=so.READERS.Exception(o));return t},Exception:function(e){var t={},o=e.getAttribute("exceptionCode");o&&(t.exceptionCode=o);var r=e.firstChild;return r&&3===r.nodeType&&(t.exception=r.nodeValue),t}},so.read=function(e){var t;if("isochronResult"===e.nodeName||"isochroneResult"===e.nodeName||"IsochroneResult"===e.nodeName)return t=so.READERS.isochronResult(e);if("ExceptionReport"===e.nodeName)return t=so.READERS[e.nodeName](e);if(so.READERS[e.nodeName]){if("error"===(t=so.READERS[e.nodeName](e)).status){var o=s.getMessage("SERVICE_RESPONSE_EXCEPTION",t.message);throw new a({message:o,type:a.TYPE_SRVERR})}return t}throw new a({message:s.getMessage("SERVICE_RESPONSE_ANALYSE",e.nodeName),type:a.TYPE_UNKERR})};var ao=so,lo={build:function(e){var t=n.getLogger("ProcessIsoCurveResponseFactory");t.trace(["ProcessIsoCurveResponseFactory::build()"]);var o=null;if(e.response){if(e.rawResponse)t.trace("analyze response : raw"),o=e.response;else{switch(e.outputFormat){case"xml":t.trace("analyze response : xml");try{var r=new D({reader:ao});if("string"==typeof e.response?r.setXMLString(e.response):r.setXMLDoc(e.response),!(o=r.parse()))throw new Error(s.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(t){var i=t.message;return i+="\n (raw response service : '"+e.response+"')",void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EXCEPTION",i),status:200,type:a.TYPE_SRVERR}))}break;case"json":t.trace("analyze response : json");var l=null;if(!(l="string"==typeof e.response?JSON.parse(e.response):e.response)||"OK"!==l.status&&"ok"!==l.status){if(l&&("ERROR"===l.status||"error"===l.status)){var c=l.message;return c+="\n (raw response service : '"+l+"')",void e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_EXCEPTION",c)))}}else{(o=new no).time=l.time,o.distance=l.distance,o.message=l.message,o.id=l.id,o.srs=l.srs;if(o.hasOwnProperty("geometry")&&(oo.toJson(l.wktGeometry,(function(e){o.geometry=e}),(function(){e.onError.call(e.scope,new a({message:s.getMessage("PARAM_FORMAT","wktGeometry")}))})),!o.geometry))return void e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_ANALYSE",e.response)));var u=l.location.split(",");o.location&&(o.location.x=u[0],o.location.y=u[1])}break;default:return void e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_FORMAT","json","xml")))}if(o&&o.exceptionReport)return void e.onError.call(e.scope,new a({message:s.getMessage("SERVICE_RESPONSE_EXCEPTION",o.exceptionReport),type:a.TYPE_SRVERR,status:200}))}e.onSuccess.call(e.scope,o)}else e.onError.call(e.scope,new a(s.getMessage("SERVICE_RESPONSE_EMPTY")))}};function co(e){if(!(this instanceof co))throw new TypeError(s.getMessage("CLASS_CONSTRUCTOR","ProcessIsoCurve"));if(this.CLASSNAME="ProcessIsoCurve",_.apply(this,arguments),this.logger=n.getLogger("Gp.Services.ProcessIsoCurve"),this.logger.trace("[Constructeur ProcessIsoCurve (options)]"),!e.position)throw new Error(s.getMessage("PARAM_MISSING","position"));if(null===e.position.x)throw new Error(s.getMessage("PARAM_MISSING","position.x"));if(null===e.position.y)throw new Error(s.getMessage("PARAM_MISSING","position.y"));if(!e.time&&!e.distance)throw new Error("Parameter (s) 'distance' missing. Parameter time to calculate an isochrone, parameter distance for an isodistance");if(!e.time&&e.distance&&(this.options.method="distance",this.options.time&&delete this.options.time),e.time&&!e.distance&&(this.options.method="time",this.options.distance&&delete this.options.distance),this.options.method=this.options.method||"time",this.options.exclusions=e.exclusions||null,this.options.graph=e.graph||"Voiture",this.options.reverse=e.reverse||!1,this.options.smoothing=e.smoothing||!1,this.options.holes=e.holes||!1,this.options.srs=e.srs||"EPSG:4326",this.options.outputFormat="string"==typeof e.outputFormat?e.outputFormat.toLowerCase():"json",!this.options.serverUrl){var t=y.ProcessIsoCurve.url(this.options.apiKey),o=t["iso-"+this.options.outputFormat];if(!o)throw new Error("Url by default not found !");this.options.serverUrl=o,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}var r=this.options.serverUrl.lastIndexOf(".");if(-1!==r){var i=this.options.serverUrl.substring(r+1);if(i&&i.length<5)switch(this.logger.trace("Serveur Extension URL : "+i),i.toLowerCase()){case"json":case"xml":this.options.outputFormat=i.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}co.prototype=Object.create(_.prototype,{}),co.prototype.constructor=co,co.prototype.buildRequest=function(e,t){try{var o=new to(this.options);if(!o.processRequestString())throw new Error(s.getMessage("SERVICE_REQUEST_BUILD"));this.request=o.requestString}catch(t){return void e.call(this,new a(t.message))}t.call(this,this.request)},co.prototype.analyzeResponse=function(e,t){if(this.response){var o={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onSuccess:t,onError:e,scope:this};lo.build(o)}else e.call(this,new a(s.getMessage("SERVICE_RESPONSE_EMPTY")))};var uo=co,po={getConfig:function(e){new Oe(e).call()},getAltitude:function(e){new H(e).call()},geocode:function(e){new _t(e).call()},reverseGeocode:function(e){new Nt(e).call()},autoComplete:function(e){new qt(e).call()},route:function(e){new Qt(e).call()},isoCurve:function(e){new uo(e).call()}},ho=E.version,fo=E.date,go={};go.servicesVersion=ho,go.servicesDate=fo,go.Protocols={},go.Protocols.XHR=f,go.Services=po,go.Services.DefaultUrl=y,go.Services.AltiResponse=k,go.Services.Alti={},go.Services.Alti.Elevation=q,go.Services.AutoCompleteResponse=Mt,go.Services.AutoComplete={},go.Services.AutoComplete.SuggestedLocation=Dt,go.Services.GetConfigResponse=K,go.Services.Config={},go.Services.Config.Constraint=W,go.Services.Config.Format=Q,go.Services.Config.Layer=Z,go.Services.Config.Legend=te,go.Services.Config.Metadata=re,go.Services.Config.Originator=se,go.Services.Config.Service=ae,go.Services.Config.Style=ce,go.Services.Config.Territory=pe,go.Services.Config.Thematic=fe,go.Services.Config.TileMatrix=ye,go.Services.Config.TileMatrixLimit=ve,go.Services.Config.TileMatrixSet=de,go.Services.GeocodeResponse=lt,go.Services.Geocode={},go.Services.Geocode.GeocodedLocation=ut,go.Services.Geocode.DirectGeocodedLocation=ht,go.Services.Geocode.ReverseGeocodedLocation=Rt,go.Services.IsoCurveResponse=no,go.Services.RouteResponse=zt,go.Services.Route={},go.Services.Route.RouteInstruction=Bt,go.Error=a,go.Helper=l;t.default=go}]).default}));